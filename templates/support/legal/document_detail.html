{% extends 'base/base.html' %}

{% block title %}{{ document.title }}{% endblock %}

{% block content %}
<style>
/* Legal Document Styling */
.legal-document-container {
    max-width: 1200px;
    margin: 0 auto;
    font-family: 'Inter', 'Poppins', -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    font-size: 16px;
    line-height: 1.6;
    color: #2d3748;
}

.document-header {
    background: #f8fafc;
    border-bottom: 2px solid #e2e8f0;
    padding: 2rem 0;
    margin-bottom: 2rem;
}

.document-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-top: 1rem;
}

.meta-item {
    background: #edf2f7;
    color: #4a5568;
    padding: 0.5rem 1rem;
    border-radius: 6px;
    font-size: 0.875rem;
    font-weight: 500;
}

.document-content {
    display: grid;
    grid-template-columns: 1fr 200px;
    gap: 2rem;
    margin-top: 2rem;
}

.content-area {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 3rem;
    box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
}

.content-area h1 {
    font-size: 2.25rem;
    font-weight: 700;
    color: #1a202c;
    margin-bottom: 1rem;
    line-height: 1.2;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #3182ce;
}

.content-area h2 {
    font-size: 1.875rem;
    font-weight: 600;
    color: #2d3748;
    margin: 2rem 0 1rem 0;
    padding-bottom: 0.5rem;
    border-bottom: 1px solid #e2e8f0;
}

.content-area h3 {
    font-size: 1.5rem;
    font-weight: 600;
    color: #2d3748;
    margin: 1.5rem 0 1rem 0;
}

.content-area h4 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #4a5568;
    margin: 1.25rem 0 0.75rem 0;
}

.content-area p {
    margin-bottom: 1.5rem;
    text-align: justify;
    color: #4a5568;
}

.content-area ul, .content-area ol {
    margin-bottom: 1.5rem;
    padding-left: 1.5rem;
}

.content-area li {
    margin-bottom: 0.5rem;
    padding-left: 0.25rem;
}

.content-area ul li {
    list-style-type: disc;
}

.content-area ol li {
    list-style-type: decimal;
}

.content-area blockquote {
    border-left: 4px solid #3182ce;
    padding-left: 1rem;
    margin: 2rem 0;
    font-style: italic;
    color: #718096;
    background: #f7fafc;
    padding: 1rem 1.5rem;
    border-radius: 0 4px 4px 0;
}

.content-area strong, .content-area b {
    font-weight: 600;
    color: #1a202c;
}

.content-area .highlight {
    background: #fefcbf;
    padding: 0.125rem 0.25rem;
    border-radius: 3px;
}

.content-area .contact-info {
    background: #edf2f7;
    padding: 1rem;
    border-radius: 6px;
    border-left: 4px solid #3182ce;
    margin: 1rem 0;
}

.content-area .contact-info h4 {
    margin-top: 0;
    color: #2d3748;
}

.content-area a {
    color: #3182ce;
    text-decoration: underline;
}

.content-area a:hover {
    color: #2c5282;
    text-decoration: none;
}

.table-of-contents {
    position: sticky;
    top: 2rem;
    height: fit-content;
}

.toc-card {
    background: white;
    border: 1px solid #e2e8f0;
    border-radius: 8px;
    padding: 1.5rem;
    box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
}

.toc-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #2d3748;
    margin-bottom: 1rem;
    padding-bottom: 0.5rem;
    border-bottom: 2px solid #3182ce;
}

.toc-list {
    list-style: none;
    padding: 0;
    margin: 0;
}

.toc-list li {
    margin-bottom: 0.5rem;
}

.toc-link {
    color: #4a5568;
    text-decoration: none;
    font-size: 0.875rem;
    display: block;
    padding: 0.375rem 0.5rem;
    border-radius: 4px;
    transition: all 0.2s;
}

.toc-link:hover, .toc-link.active {
    background: #edf2f7;
    color: #3182ce;
    text-decoration: none;
}

.toc-list ul {
    padding-left: 1rem;
    margin-top: 0.5rem;
}

.document-actions {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    justify-content: center;
}

.action-btn {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    border: 1px solid #e2e8f0;
    border-radius: 6px;
    background: white;
    color: #4a5568;
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s;
}

.action-btn:hover {
    background: #edf2f7;
    border-color: #cbd5e0;
    color: #2d3748;
    text-decoration: none;
}

.action-btn.primary {
    background: #3182ce;
    color: white;
    border-color: #3182ce;
}

.action-btn.primary:hover {
    background: #2c5282;
    border-color: #2c5282;
    color: white;
}

@media (max-width: 768px) {
    .document-content {
        grid-template-columns: 1fr;
    }

    .table-of-contents {
        position: static;
        margin-top: 2rem;
    }

    .content-area {
        padding: 2rem;
    }

    .document-actions {
        flex-direction: column;
    }

    .document-meta {
        justify-content: center;
    }
}

@media print {
    .document-actions, .table-of-contents, .breadcrumb, .mt-4 {
        display: none !important;
    }

    .content-area {
        box-shadow: none;
        border: none;
        padding: 0;
    }
}
</style>

<div class="legal-document-container">
    <nav aria-label="breadcrumb" class="mb-4">
        <ol class="breadcrumb">
            <li class="breadcrumb-item"><a href="{% url 'support:home' %}">Support Home</a></li>
            <li class="breadcrumb-item active" aria-current="page">{{ document.title }}</li>
        </ol>
    </nav>

    <div class="document-header text-center">
        <h1 class="h2 mb-0">{{ document.title }}</h1>
        <div class="document-meta justify-content-center">
            <span class="meta-item">{{ document.get_document_type_display }}</span>
            {% if document.version %}
            <span class="meta-item">Version {{ document.version }}</span>
            {% endif %}
            <span class="meta-item">Updated {{ document.updated_at|date:"M d, Y" }}</span>
        </div>
    </div>

    <div class="document-content">
        <div class="content-area">
            <div class="legal-content">
                {{ document.content|safe }}
            </div>
        </div>

        <aside class="table-of-contents">
            <div class="toc-card">
                <div class="toc-title">Contents</div>
                <ul class="toc-list" id="toc-list">
                    <!-- Table of contents will be populated by JavaScript -->
                </ul>
            </div>
        </aside>
    </div>

    <div class="document-actions">
        <button onclick="window.print()" class="action-btn">
            <i class="fas fa-print"></i>
            Print Document
        </button>
        <a href="{% url 'support:legal_documents_list' %}" class="action-btn">
            <i class="fas fa-list"></i>
            All Legal Documents
        </a>
        <a href="{% url 'support:home' %}" class="action-btn primary">
            <i class="fas fa-arrow-left"></i>
            Back to Support
        </a>
    </div>
</div>

<script>
// Generate table of contents from headings
document.addEventListener('DOMContentLoaded', function() {
    const content = document.querySelector('.legal-content');
    const tocList = document.getElementById('toc-list');
    const headings = content.querySelectorAll('h1, h2, h3, h4, h5, h6');

    if (headings.length === 0) {
        tocList.innerHTML = '<li class="text-muted">No sections found</li>';
        return;
    }

    let currentLevel = null;
    let currentUl = tocList;

    headings.forEach((heading, index) => {
        const level = parseInt(heading.tagName.substring(1));
        const id = `heading-${index}`;
        heading.id = id;

        const li = document.createElement('li');
        const a = document.createElement('a');
        a.href = `#${id}`;
        a.className = 'toc-link';
        a.textContent = heading.textContent;

        // Handle nested lists
        if (currentLevel === null) {
            currentLevel = level;
        } else if (level > currentLevel) {
            const newUl = document.createElement('ul');
            newUl.className = 'toc-list';
            currentUl.lastElementChild.appendChild(newUl);
            currentUl = newUl;
            currentLevel = level;
        } else if (level < currentLevel) {
            while (currentLevel > level && currentUl.parentElement) {
                currentUl = currentUl.parentElement.closest('ul') || tocList;
                currentLevel--;
            }
        }

        li.appendChild(a);
        currentUl.appendChild(li);

        // Smooth scrolling
        a.addEventListener('click', function(e) {
            e.preventDefault();
            const target = document.getElementById(id);
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
                history.pushState(null, null, `#${id}`);
            }
        });
    });

    // Highlight active section in viewport
    function highlightActiveSection() {
        const headings = content.querySelectorAll('h1[id], h2[id], h3[id], h4[id], h5[id], h6[id]');
        const tocLinks = tocList.querySelectorAll('.toc-link');

        let activeIndex = -1;
        headings.forEach((heading, index) => {
            const rect = heading.getBoundingClientRect();
            if (rect.top <= 100 && rect.bottom >= 100) {
                activeIndex = index;
            }
        });

        tocLinks.forEach(link => link.classList.remove('active'));
        if (activeIndex >= 0) {
            tocLinks[activeIndex].classList.add('active');
        }
    }

    window.addEventListener('scroll', highlightActiveSection);
    window.addEventListener('resize', highlightActiveSection);

    // Initial highlight
    setTimeout(highlightActiveSection, 100);
});

// Check for hash in URL and scroll to section
if (window.location.hash) {
    const targetId = window.location.hash.substring(1);
    const target = document.getElementById(targetId);
    if (target) {
        setTimeout(() => {
            target.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }, 100);
    }
}
</script>
{% endblock %}
