<!-- templates/library/authors/author_detail.html -->
{% extends 'base/base.html' %}
{% load static i18n %}

{% block title %}{{ author.full_name }} - {% trans "Author Details" %}{% endblock %}

{% block page_title %}{% trans "Author Details" %}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'users:dashboard' %}">{% trans "Home" %}</a></li>
<li class="breadcrumb-item"><a href="{% url 'library:dashboard' %}">{% trans "Library" %}</a></li>
<li class="breadcrumb-item"><a href="{% url 'library:author_list' %}">{% trans "Authors" %}</a></li>
<li class="breadcrumb-item active" aria-current="page">{{ author.full_name }}</li>
{% endblock %}

{% block extra_css %}
<style>
    /* Author Detail Specific Styles */
    .author-header-card {
        border-left: 4px solid #65a0f9;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
    }
    
    .author-header-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .author-stat-card {
        border-left: 4px solid;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        height: 100%;
    }
    
    .author-stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .stat-card-1 { border-left-color: #65a0f9; }
    .stat-card-2 { border-left-color: #28a745; }
    .stat-card-3 { border-left-color: #ffc107; }
    
    .author-stat-number {
        font-size: 1.8rem;
        font-weight: 700;
        line-height: 1;
    }
    
    .author-stat-label {
        font-size: 0.875rem;
        color: #6c757d;
        font-weight: 500;
    }
    
    .author-stat-icon {
        font-size: 1.5rem;
        opacity: 0.8;
    }
    
    .book-item {
        border-left: 3px solid transparent;
        transition: all 0.2s ease;
        padding: 1rem;
    }
    
    .book-item:hover {
        border-left-color: #65a0f9;
        background-color: rgba(101, 160, 249, 0.05);
    }
    
    .book-cover-small {
        width: 50px;
        height: 65px;
        object-fit: cover;
        border-radius: 4px;
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
    }
    
    .status-badge {
        font-size: 0.75rem;
        padding: 0.25rem 0.5rem;
    }
    
    .bio-content {
        line-height: 1.6;
        max-height: 200px;
        overflow-y: auto;
    }
    
    .timeline-item {
        border-left: 3px solid #65a0f9;
        padding-left: 1.5rem;
        position: relative;
        margin-bottom: 1.5rem;
    }
    
    .timeline-item::before {
        content: '';
        position: absolute;
        left: -8px;
        top: 0;
        width: 14px;
        height: 14px;
        border-radius: 50%;
        background-color: #65a0f9;
    }
    
    @media (max-width: 768px) {
        .author-stat-number {
            font-size: 1.5rem;
        }
        
        .book-cover-small {
            width: 40px;
            height: 52px;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Author Header Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card author-header-card">
                <div class="card-body">
                    <div class="row align-items-center">
                        <div class="col-md-8">
                            <h2 class="card-title mb-2">{{ author.full_name }}</h2>
                            {% if author.nationality %}
                            <p class="text-muted mb-2">
                                <i class="bi bi-geo-alt me-1"></i>
                                {{ author.nationality }}
                            </p>
                            {% endif %}
                            
                            <!-- Author Lifespan -->
                            <div class="d-flex flex-wrap gap-3 mb-3">
                                {% if author.date_of_birth %}
                                <div>
                                    <small class="text-muted">{% trans "Born" %}:</small>
                                    <strong>{{ author.date_of_birth|date:"F j, Y" }}</strong>
                                </div>
                                {% endif %}
                                
                                {% if author.date_of_death %}
                                <div>
                                    <small class="text-muted">{% trans "Died" %}:</small>
                                    <strong>{{ author.date_of_death|date:"F j, Y" }}</strong>
                                </div>
                                {% endif %}
                                
                                {% if author.date_of_birth and author.date_of_death %}
                                <div>
                                    <small class="text-muted">{% trans "Age" %}:</small>
                                    <strong>{{ author.age_at_death }}</strong>
                                </div>
                                {% endif %}
                            </div>
                            
                            <!-- Status Badge -->
                            <div>
                                <span class="badge {% if author.status == 'active' %}bg-success{% else %}bg-secondary{% endif %}">
                                    {{ author.get_status_display }}
                                </span>
                            </div>
                        </div>
                        <div class="col-md-4 text-md-end">
                            <div class="btn-group mt-3 mt-md-0">
                                <a href="{% url 'library:author_update' author.pk %}" class="btn btn-primary">
                                    <i class="bi bi-pencil me-1"></i> {% trans "Edit" %}
                                </a>
                                <a href="{% url 'library:author_list' %}" class="btn btn-outline-secondary">
                                    <i class="bi bi-arrow-left me-1"></i> {% trans "Back to List" %}
                                </a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Author Statistics -->
    <div class="row mb-4">
        <div class="col-xl-4 col-md-6 mb-3">
            <div class="card author-stat-card stat-card-1 h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="author-stat-number text-primary">{{ books.count }}</div>
                            <div class="author-stat-label">{% trans "Total Books" %}</div>
                        </div>
                        <div class="author-stat-icon text-primary">
                            <i class="bi bi-book"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-4 col-md-6 mb-3">
            <div class="card author-stat-card stat-card-2 h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="author-stat-number text-success">{{ available_books_count }}</div>
                            <div class="author-stat-label">{% trans "Available Books" %}</div>
                        </div>
                        <div class="author-stat-icon text-success">
                            <i class="bi bi-check-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-4 col-md-6 mb-3">
            <div class="card author-stat-card stat-card-3 h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="author-stat-number text-warning">{{ total_borrow_count }}</div>
                            <div class="author-stat-label">{% trans "Total Times Borrowed" %}</div>
                        </div>
                        <div class="author-stat-icon text-warning">
                            <i class="bi bi-arrow-left-right"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Main Content Area -->
    <div class="row">
        <!-- Left Column: Author Biography and Details -->
        <div class="col-lg-4">
            <!-- Author Biography -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-person-badge text-primary me-2"></i>
                        {% trans "Biography" %}
                    </h5>
                </div>
                <div class="card-body">
                    {% if author.bio %}
                    <div class="bio-content">
                        {{ author.bio|linebreaks }}
                    </div>
                    {% else %}
                    <div class="text-center text-muted py-3">
                        <i class="bi bi-info-circle display-6 d-block mb-2"></i>
                        <p>{% trans "No biography available for this author." %}</p>
                    </div>
                    {% endif %}
                </div>
            </div>
            
            <!-- Author Timeline -->
            <div class="card mb-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-clock-history text-info me-2"></i>
                        {% trans "Author Timeline" %}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="timeline">
                        {% if author.date_of_birth %}
                        <div class="timeline-item">
                            <h6 class="mb-1">{% trans "Birth" %}</h6>
                            <p class="mb-1 text-muted">{{ author.date_of_birth|date:"F j, Y" }}</p>
                            <p class="small mb-0">{% trans "Author was born" %}</p>
                        </div>
                        {% endif %}
                        
                        {% if author.date_of_death %}
                        <div class="timeline-item">
                            <h6 class="mb-1">{% trans "Death" %}</h6>
                            <p class="mb-1 text-muted">{{ author.date_of_death|date:"F j, Y" }}</p>
                            <p class="small mb-0">{% trans "Author passed away" %}</p>
                        </div>
                        {% endif %}
                        
                        {% if not author.date_of_birth and not author.date_of_death %}
                        <div class="text-center text-muted py-3">
                            <i class="bi bi-clock display-6 d-block mb-2"></i>
                            <p>{% trans "No timeline information available." %}</p>
                        </div>
                        {% endif %}
                    </div>
                </div>
            </div>
            
            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-lightning-charge text-warning me-2"></i>
                        {% trans "Quick Actions" %}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'library:book_create' %}?author={{ author.id }}" class="btn btn-outline-primary">
                            <i class="bi bi-plus-circle me-2"></i> {% trans "Add Book by This Author" %}
                        </a>
                        <a href="{% url 'library:author_update' author.pk %}" class="btn btn-outline-success">
                            <i class="bi bi-pencil me-2"></i> {% trans "Edit Author" %}
                        </a>
                        <button class="btn btn-outline-info" data-bs-toggle="modal" data-bs-target="#exportAuthorModal">
                            <i class="bi bi-download me-2"></i> {% trans "Export Author Data" %}
                        </button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Right Column: Author's Books -->
        <div class="col-lg-8">
            <!-- Author's Books -->
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-book text-primary me-2"></i>
                        {% trans "Books by This Author" %}
                    </h5>
                    <span class="badge bg-primary rounded-pill">{{ books.count }}</span>
                </div>
                <div class="card-body p-0">
                    {% if books %}
                    <div class="table-responsive">
                        <table class="table table-hover mb-0">
                            <thead class="table-light">
                                <tr>
                                    <th>{% trans "Book" %}</th>
                                    <th>{% trans "Publisher" %}</th>
                                    <th>{% trans "Category" %}</th>
                                    <th class="text-center">{% trans "Status" %}</th>
                                    <th class="text-center">{% trans "Available" %}</th>
                                    <th class="text-center">{% trans "Actions" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for book in books %}
                                <tr class="book-item">
                                    <td>
                                        <div class="d-flex align-items-center">
                                            {% if book.cover_image %}
                                            <img src="{{ book.cover_image.url }}" alt="{{ book.title }}" class="book-cover-small me-3">
                                            {% else %}
                                            <div class="book-cover-small bg-light d-flex align-items-center justify-content-center me-3">
                                                <i class="bi bi-book text-muted"></i>
                                            </div>
                                            {% endif %}
                                            <div>
                                                <strong>{{ book.title }}</strong>
                                                {% if book.edition %}
                                                <div class="text-muted small">{% trans "Edition" %} {{ book.edition }}</div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    </td>
                                    <td>
                                        {% if book.publisher %}
                                        {{ book.publisher.name }}
                                        {% else %}
                                        <span class="text-muted">{% trans "Not specified" %}</span>
                                        {% endif %}
                                    </td>
                                    <td>
                                        {% if book.category %}
                                        <span class="badge bg-light text-dark">{{ book.category.name }}</span>
                                        {% else %}
                                        <span class="text-muted">{% trans "Uncategorized" %}</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        {% if book.book_status == 'available' %}
                                        <span class="badge bg-success status-badge">{% trans "Available" %}</span>
                                        {% elif book.book_status == 'borrowed' %}
                                        <span class="badge bg-warning status-badge">{% trans "Borrowed" %}</span>
                                        {% elif book.book_status == 'reserved' %}
                                        <span class="badge bg-info status-badge">{% trans "Reserved" %}</span>
                                        {% else %}
                                        <span class="badge bg-secondary status-badge">{{ book.get_book_status_display }}</span>
                                        {% endif %}
                                    </td>
                                    <td class="text-center">
                                        <span class="badge {% if book.available_copies > 0 %}bg-success{% else %}bg-danger{% endif %} rounded-pill">
                                            {{ book.available_copies }}/{{ book.total_copies }}
                                        </span>
                                    </td>
                                    <td class="text-center">
                                        <div class="btn-group btn-group-sm">
                                            <a href="{% url 'library:book_detail' book.pk %}" class="btn btn-outline-primary" title="{% trans 'View Details' %}">
                                                <i class="bi bi-eye"></i>
                                            </a>
                                            <a href="{% url 'library:book_update' book.pk %}" class="btn btn-outline-success" title="{% trans 'Edit Book' %}">
                                                <i class="bi bi-pencil"></i>
                                            </a>
                                        </div>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                    {% else %}
                    <div class="text-center py-5 text-muted">
                        <i class="bi bi-book display-4 d-block mb-3"></i>
                        <h5>{% trans "No books found" %}</h5>
                        <p class="mb-0">{% trans "This author doesn't have any books in the library yet." %}</p>
                        <a href="{% url 'library:book_create' %}?author={{ author.id }}" class="btn btn-primary mt-3">
                            <i class="bi bi-plus-circle me-2"></i> {% trans "Add First Book" %}
                        </a>
                    </div>
                    {% endif %}
                </div>
                {% if books.count > 10 %}
                <div class="card-footer text-center">
                    <a href="{% url 'library:book_list' %}?author={{ author.id }}" class="btn btn-outline-primary">
                        <i class="bi bi-list-ul me-2"></i> {% trans "View All Books by This Author" %}
                    </a>
                </div>
                {% endif %}
            </div>
            
            <!-- Related Authors Section -->
            {% if related_authors %}
            <div class="card mt-4">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi bi-people text-info me-2"></i>
                        {% trans "Related Authors" %}
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        {% for related_author in related_authors %}
                        <div class="col-md-6 col-lg-4 mb-3">
                            <div class="card h-100">
                                <div class="card-body text-center">
                                    <h6 class="card-title">{{ related_author.full_name }}</h6>
                                    {% if related_author.nationality %}
                                    <p class="card-text small text-muted">{{ related_author.nationality }}</p>
                                    {% endif %}
                                    <p class="card-text">
                                        <small class="text-muted">
                                            {{ related_author.book_count }} {% trans "book(s)" %}
                                        </small>
                                    </p>
                                    <a href="{% url 'library:author_detail' related_author.pk %}" class="btn btn-sm btn-outline-primary">
                                        {% trans "View Profile" %}
                                    </a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                </div>
            </div>
            {% endif %}
        </div>
    </div>
</div>

<!-- Export Author Modal -->
<div class="modal fade" id="exportAuthorModal" tabindex="-1" aria-labelledby="exportAuthorModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="exportAuthorModalLabel">{% trans "Export Author Data" %}</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <p>{% trans "Choose the format for exporting author data:" %}</p>
                <div class="list-group">
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <span>
                            <i class="bi bi-filetype-pdf text-danger me-2"></i>
                            {% trans "PDF Document" %}
                        </span>
                        <i class="bi bi-download text-muted"></i>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <span>
                            <i class="bi bi-file-spreadsheet text-success me-2"></i>
                            {% trans "Excel Spreadsheet" %}
                        </span>
                        <i class="bi bi-download text-muted"></i>
                    </a>
                    <a href="#" class="list-group-item list-group-item-action d-flex justify-content-between align-items-center">
                        <span>
                            <i class="bi bi-file-text text-primary me-2"></i>
                            {% trans "CSV File" %}
                        </span>
                        <i class="bi bi-download text-muted"></i>
                    </a>
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">{% trans "Close" %}</button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Bio content expand/collapse functionality
        const bioContent = document.querySelector('.bio-content');
        if (bioContent && bioContent.scrollHeight > 200) {
            const readMoreBtn = document.createElement('button');
            readMoreBtn.className = 'btn btn-sm btn-outline-primary mt-2';
            readMoreBtn.textContent = '{% trans "Read More" %}';
            readMoreBtn.type = 'button';
            
            readMoreBtn.addEventListener('click', function() {
                if (bioContent.style.maxHeight) {
                    bioContent.style.maxHeight = null;
                    readMoreBtn.textContent = '{% trans "Read More" %}';
                } else {
                    bioContent.style.maxHeight = 'none';
                    readMoreBtn.textContent = '{% trans "Show Less" %}';
                }
            });
            
            bioContent.parentNode.appendChild(readMoreBtn);
        }
    });
</script>
{% endblock %}