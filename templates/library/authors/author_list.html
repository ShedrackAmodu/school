<!-- templates/library/authors/author_list.html -->
{% extends 'base/base.html' %}
{% load static i18n %}

{% block title %}{% trans "Authors" %}{% endblock %}

{% block page_title %}{% trans "Authors Management" %}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'users:dashboard' %}">{% trans "Home" %}</a></li>
<li class="breadcrumb-item"><a href="{% url 'library:dashboard' %}">{% trans "Library" %}</a></li>
<li class="breadcrumb-item active" aria-current="page">{% trans "Authors" %}</li>
{% endblock %}

{% block extra_css %}
<style>
    /* Authors List Specific Styles */
    .author-card {
        border-left: 4px solid #65a0f9;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        height: 100%;
    }
    
    .author-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .stats-card {
        border-left: 4px solid;
        transition: transform 0.2s ease, box-shadow 0.2s ease;
        height: 100%;
    }
    
    .stats-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.1);
    }
    
    .stats-card-1 { border-left-color: #65a0f9; }
    .stats-card-2 { border-left-color: #28a745; }
    .stats-card-3 { border-left-color: #ffc107; }
    .stats-card-4 { border-left-color: #6f42c1; }
    
    .stat-number {
        font-size: 1.8rem;
        font-weight: 700;
        line-height: 1;
    }
    
    .stat-label {
        font-size: 0.875rem;
        color: #6c757d;
        font-weight: 500;
    }
    
    .stat-icon {
        font-size: 1.5rem;
        opacity: 0.8;
    }
    
    .author-avatar {
        width: 60px;
        height: 60px;
        border-radius: 50%;
        object-fit: cover;
        background: linear-gradient(135deg, #65a0f9, #6f42c1);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: bold;
        font-size: 1.5rem;
    }
    
    .author-meta {
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    .book-count-badge {
        font-size: 0.75rem;
    }
    
    .action-buttons .btn {
        font-size: 0.8rem;
        padding: 0.25rem 0.5rem;
    }
    
    .search-card {
        background-color: #f8f9fa;
        border: 1px solid #dee2e6;
    }
    
    .pagination .page-link {
        color: #65a0f9;
    }
    
    .pagination .page-item.active .page-link {
        background-color: #65a0f9;
        border-color: #65a0f9;
    }
    
    @media (max-width: 768px) {
        .stat-number {
            font-size: 1.5rem;
        }
        
        .author-avatar {
            width: 50px;
            height: 50px;
            font-size: 1.2rem;
        }
        
        .action-buttons .btn {
            font-size: 0.7rem;
            padding: 0.2rem 0.4rem;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Statistics Cards -->
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card stats-card stats-card-1 h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number text-primary">{{ authors.paginator.count }}</div>
                            <div class="stat-label">{% trans "Total Authors" %}</div>
                        </div>
                        <div class="stat-icon text-primary">
                            <i class="bi bi-people"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card stats-card stats-card-2 h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number text-success">{{ active_authors_count }}</div>
                            <div class="stat-label">{% trans "Active Authors" %}</div>
                        </div>
                        <div class="stat-icon text-success">
                            <i class="bi bi-check-circle"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card stats-card stats-card-3 h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number text-warning">{{ total_books_count }}</div>
                            <div class="stat-label">{% trans "Total Books" %}</div>
                        </div>
                        <div class="stat-icon text-warning">
                            <i class="bi bi-book"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-xl-3 col-md-6 mb-3">
            <div class="card stats-card stats-card-4 h-100">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-start">
                        <div>
                            <div class="stat-number text-info">{{ average_books_per_author|floatformat:1 }}</div>
                            <div class="stat-label">{% trans "Avg Books per Author" %}</div>
                        </div>
                        <div class="stat-icon text-info">
                            <i class="bi bi-graph-up"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Search and Actions Bar -->
    <div class="card search-card mb-4">
        <div class="card-body">
            <div class="row align-items-center">
                <div class="col-md-8">
                    <form method="get" class="row g-2">
                        <div class="col-md-6">
                            <div class="input-group">
                                <input type="text" 
                                       name="search" 
                                       class="form-control" 
                                       placeholder="{% trans 'Search authors by name or nationality...' %}"
                                       value="{{ request.GET.search }}">
                                <button class="btn btn-primary" type="submit">
                                    <i class="bi bi-search"></i>
                                </button>
                            </div>
                        </div>
                        <div class="col-md-3">
                            <select name="status" class="form-select">
                                <option value="">{% trans "All Status" %}</option>
                                <option value="active" {% if request.GET.status == 'active' %}selected{% endif %}>
                                    {% trans "Active" %}
                                </option>
                                <option value="inactive" {% if request.GET.status == 'inactive' %}selected{% endif %}>
                                    {% trans "Inactive" %}
                                </option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <select name="sort" class="form-select">
                                <option value="">{% trans "Sort by" %}</option>
                                <option value="name" {% if request.GET.sort == 'name' %}selected{% endif %}>
                                    {% trans "Name (A-Z)" %}
                                </option>
                                <option value="-name" {% if request.GET.sort == '-name' %}selected{% endif %}>
                                    {% trans "Name (Z-A)" %}
                                </option>
                                <option value="-book_count" {% if request.GET.sort == '-book_count' %}selected{% endif %}>
                                    {% trans "Most Books" %}
                                </option>
                                <option value="book_count" {% if request.GET.sort == 'book_count' %}selected{% endif %}>
                                    {% trans "Fewest Books" %}
                                </option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="col-md-4 text-md-end">
                    <div class="btn-group">
                        <a href="{% url 'library:author_create' %}" class="btn btn-success">
                            <i class="bi bi-plus-circle me-1"></i> {% trans "Add New Author" %}
                        </a>
                        <button type="button" class="btn btn-outline-primary dropdown-toggle" data-bs-toggle="dropdown">
                            <i class="bi bi-download me-1"></i> {% trans "Export" %}
                        </button>
                        <ul class="dropdown-menu">
                            <li><a class="dropdown-item" href="#"><i class="bi bi-filetype-pdf me-2"></i> PDF</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-file-spreadsheet me-2"></i> Excel</a></li>
                            <li><a class="dropdown-item" href="#"><i class="bi bi-file-text me-2"></i> CSV</a></li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Authors Grid/List -->
    <div class="row">
        {% for author in authors %}
        <div class="col-xl-4 col-lg-6 col-md-6 mb-4">
            <div class="card author-card h-100">
                <div class="card-body">
                    <div class="row align-items-start">
                        <div class="col-3">
                            <div class="author-avatar">
                                {{ author.first_name|first }}{{ author.last_name|first }}
                            </div>
                        </div>
                        <div class="col-9">
                            <h5 class="card-title mb-1">{{ author.full_name }}</h5>
                            
                            <div class="author-meta mb-2">
                                {% if author.nationality %}
                                <div>
                                    <i class="bi bi-geo-alt me-1"></i>
                                    {{ author.nationality }}
                                </div>
                                {% endif %}
                                
                                {% if author.date_of_birth %}
                                <div>
                                    <i class="bi bi-calendar me-1"></i>
                                    {{ author.date_of_birth|date:"Y" }}
                                    {% if author.date_of_death %}
                                    - {{ author.date_of_death|date:"Y" }}
                                    {% endif %}
                                </div>
                                {% endif %}
                            </div>
                            
                            <div class="d-flex justify-content-between align-items-center">
                                <span class="badge bg-primary book-count-badge">
                                    <i class="bi bi-book me-1"></i>
                                    {{ author.book_count }} {% trans "book(s)" %}
                                </span>
                                
                                <span class="badge {% if author.status == 'active' %}bg-success{% else %}bg-secondary{% endif %} book-count-badge">
                                    {{ author.get_status_display }}
                                </span>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="card-footer bg-transparent">
                    <div class="row action-buttons">
                        <div class="col-4">
                            <a href="{% url 'library:author_detail' author.pk %}" class="btn btn-outline-primary w-100" title="{% trans 'View Details' %}">
                                <i class="bi bi-eye"></i>
                            </a>
                        </div>
                        <div class="col-4">
                            <a href="{% url 'library:author_update' author.pk %}" class="btn btn-outline-success w-100" title="{% trans 'Edit Author' %}">
                                <i class="bi bi-pencil"></i>
                            </a>
                        </div>
                        <div class="col-4">
                            <a href="{% url 'library:book_list' %}?author={{ author.id }}" class="btn btn-outline-info w-100" title="{% trans 'View Books' %}">
                                <i class="bi bi-book"></i>
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% empty %}
        <div class="col-12">
            <div class="card">
                <div class="card-body text-center py-5">
                    <i class="bi bi-people display-1 text-muted d-block mb-3"></i>
                    <h4>{% trans "No Authors Found" %}</h4>
                    <p class="text-muted mb-4">
                        {% if request.GET.search %}
                        {% trans "No authors match your search criteria." %}
                        {% else %}
                        {% trans "No authors have been added to the library yet." %}
                        {% endif %}
                    </p>
                    <a href="{% url 'library:author_create' %}" class="btn btn-primary">
                        <i class="bi bi-plus-circle me-2"></i> {% trans "Add First Author" %}
                    </a>
                </div>
            </div>
        </div>
        {% endfor %}
    </div>
    
    <!-- Pagination -->
    {% if authors.has_other_pages %}
    <div class="row mt-4">
        <div class="col-12">
            <nav aria-label="Authors pagination">
                <ul class="pagination justify-content-center">
                    {% if authors.has_previous %}
                    <li class="page-item">
                        <a class="page-link" href="?page=1{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            <i class="bi bi-chevron-double-left"></i>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ authors.previous_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            <i class="bi bi-chevron-left"></i>
                        </a>
                    </li>
                    {% endif %}
                    
                    {% for num in authors.paginator.page_range %}
                        {% if authors.number == num %}
                        <li class="page-item active">
                            <span class="page-link">{{ num }}</span>
                        </li>
                        {% elif num > authors.number|add:'-3' and num < authors.number|add:'3' %}
                        <li class="page-item">
                            <a class="page-link" href="?page={{ num }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">{{ num }}</a>
                        </li>
                        {% endif %}
                    {% endfor %}
                    
                    {% if authors.has_next %}
                    <li class="page-item">
                        <a class="page-link" href="?page={{ authors.next_page_number }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            <i class="bi bi-chevron-right"></i>
                        </a>
                    </li>
                    <li class="page-item">
                        <a class="page-link" href="?page={{ authors.paginator.num_pages }}{% for key, value in request.GET.items %}{% if key != 'page' %}&{{ key }}={{ value }}{% endif %}{% endfor %}">
                            <i class="bi bi-chevron-double-right"></i>
                        </a>
                    </li>
                    {% endif %}
                </ul>
            </nav>
            
            <div class="text-center text-muted mt-2">
                {% blocktrans with number=authors.number num_pages=authors.paginator.num_pages count=authors.paginator.count %}
                Page {{ number }} of {{ num_pages }} ({{ count }} total authors)
                {% endblocktrans %}
            </div>
        </div>
    </div>
    {% endif %}
    
    <!-- Quick Stats Footer -->
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-body">
                    <div class="row text-center">
                        <div class="col-md-3 col-6 border-end">
                            <div class="py-2">
                                <div class="h5 text-primary mb-1">{{ authors_with_books_count }}</div>
                                <small class="text-muted">{% trans "Authors with Books" %}</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 border-end">
                            <div class="py-2">
                                <div class="h5 text-success mb-1">{{ authors_without_books_count }}</div>
                                <small class="text-muted">{% trans "Authors without Books" %}</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6 border-end">
                            <div class="py-2">
                                <div class="h5 text-info mb-1">{{ most_prolific_author.book_count }}</div>
                                <small class="text-muted">{% trans "Most Books by Single Author" %}</small>
                            </div>
                        </div>
                        <div class="col-md-3 col-6">
                            <div class="py-2">
                                <div class="h5 text-warning mb-1">{{ unique_nationalities_count }}</div>
                                <small class="text-muted">{% trans "Unique Nationalities" %}</small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Initialize tooltips
        const tooltipTriggerList = [].slice.call(document.querySelectorAll('[title]'));
        const tooltipList = tooltipTriggerList.map(function (tooltipTriggerEl) {
            return new bootstrap.Tooltip(tooltipTriggerEl);
        });
        
        // Auto-submit form when sort or status changes
        const sortSelect = document.querySelector('select[name="sort"]');
        const statusSelect = document.querySelector('select[name="status"]');
        
        if (sortSelect) {
            sortSelect.addEventListener('change', function() {
                this.form.submit();
            });
        }
        
        if (statusSelect) {
            statusSelect.addEventListener('change', function() {
                this.form.submit();
            });
        }
        
        // Clear search functionality
        const searchInput = document.querySelector('input[name="search"]');
        if (searchInput && searchInput.value) {
            const clearSearchBtn = document.createElement('button');
            clearSearchBtn.type = 'button';
            clearSearchBtn.className = 'btn btn-outline-secondary';
            clearSearchBtn.innerHTML = '<i class="bi bi-x"></i>';
            clearSearchBtn.title = '{% trans "Clear search" %}';
            
            clearSearchBtn.addEventListener('click', function() {
                searchInput.value = '';
                searchInput.form.submit();
            });
            
            searchInput.parentNode.appendChild(clearSearchBtn);
        }
    });
</script>
{% endblock %}