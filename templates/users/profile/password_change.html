{% extends 'base/base.html' %}
{% load static i18n %}

{% block title %}{% trans "Change Password - Excellence Academy" %}{% endblock %}

{% block meta_description %}{% trans "Change your account password to maintain security. Use a strong, unique password to protect your Excellence Academy account." %}{% endblock %}

{% block body_class %}password-change-page{% endblock %}

{% block content %}
<div class="container-fluid">
    <div class="row justify-content-center">
        <div class="col-lg-8 col-xl-6">
            <!-- Password Change Card -->
            <div class="card border-0 shadow-sm">
                <div class="card-header bg-primary text-white py-3">
                    <div class="d-flex align-items-center">
                        <i class="bi bi-shield-lock me-3 fs-4"></i>
                        <div>
                            <h4 class="mb-0 fw-bold">{% trans "Change Password" %}</h4>
                            <p class="mb-0 opacity-75">{% trans "Secure your account with a new password" %}</p>
                        </div>
                    </div>
                </div>

                <div class="card-body p-4">
                    <!-- Security Status -->
                    <div class="security-status-alert alert alert-info border-0 mb-4">
                        <div class="d-flex align-items-center">
                            <i class="bi bi-info-circle-fill me-3 fs-5"></i>
                            <div>
                                <h6 class="alert-heading mb-1">{% trans "Password Security Tips" %}</h6>
                                <p class="mb-0 small">
                                    {% trans "Use a strong password with at least 8 characters including uppercase, lowercase, numbers, and symbols." %}
                                </p>
                            </div>
                        </div>
                    </div>

                    <!-- Password Strength Meter -->
                    <div class="password-strength-meter mb-4" style="display: none;">
                        <div class="d-flex justify-content-between align-items-center mb-2">
                            <span class="small fw-semibold">{% trans "Password Strength" %}</span>
                            <span class="small" id="passwordStrengthText">{% trans "Weak" %}</span>
                        </div>
                        <div class="progress" style="height: 6px;">
                            <div class="progress-bar" id="passwordStrengthBar" role="progressbar" style="width: 0%"></div>
                        </div>
                        <div class="password-requirements mt-2" id="passwordRequirements">
                            <small class="text-muted">
                                {% trans "Include uppercase, lowercase, numbers, and special characters" %}
                            </small>
                        </div>
                    </div>

                    <!-- Password Change Form -->
                    <form method="post" id="passwordChangeForm" novalidate>
                        {% csrf_token %}

                        {% if form.non_field_errors %}
                        <div class="alert alert-danger alert-dismissible fade show" role="alert">
                            <i class="bi bi-exclamation-triangle-fill me-2"></i>
                            {{ form.non_field_errors.0 }}
                            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        {% endif %}

                        <div class="row g-3">
                            <!-- Current Password -->
                            <div class="col-12">
                                <label for="{{ form.old_password.id_for_label }}" class="form-label fw-semibold">
                                    {% trans "Current Password" %} *
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-lock text-muted"></i>
                                    </span>
                                    <input type="password" 
                                           class="form-control {% if form.old_password.errors %}is-invalid{% endif %} border-start-0" 
                                           id="{{ form.old_password.id_for_label }}"
                                           name="{{ form.old_password.name }}"
                                           placeholder="{% trans 'Enter your current password' %}"
                                           required
                                           autocomplete="current-password">
                                    <button type="button" class="input-group-text border-start-0 toggle-password" data-target="{{ form.old_password.id_for_label }}">
                                        <i class="bi bi-eye text-muted"></i>
                                    </button>
                                </div>
                                {% if form.old_password.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.old_password.errors.0 }}
                                </div>
                                {% endif %}
                                <div class="form-text">
                                    <i class="bi bi-info-circle me-1"></i>
                                    {% trans "You must confirm your current password to make changes" %}
                                </div>
                            </div>

                            <!-- New Password -->
                            <div class="col-12">
                                <label for="{{ form.new_password1.id_for_label }}" class="form-label fw-semibold">
                                    {% trans "New Password" %} *
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-key text-muted"></i>
                                    </span>
                                    <input type="password" 
                                           class="form-control {% if form.new_password1.errors %}is-invalid{% endif %} border-start-0" 
                                           id="{{ form.new_password1.id_for_label }}"
                                           name="{{ form.new_password1.name }}"
                                           placeholder="{% trans 'Create a new strong password' %}"
                                           required
                                           autocomplete="new-password"
                                           data-strength-meter="true">
                                    <button type="button" class="input-group-text border-start-0 toggle-password" data-target="{{ form.new_password1.id_for_label }}">
                                        <i class="bi bi-eye text-muted"></i>
                                    </button>
                                </div>
                                {% if form.new_password1.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.new_password1.errors.0 }}
                                </div>
                                {% endif %}

                                <!-- Password Requirements -->
                                <div class="password-requirements-list mt-2">
                                    <small class="text-muted d-block mb-2">{% trans "Password must contain:" %}</small>
                                    <div class="row g-1">
                                        <div class="col-md-6">
                                            <div class="requirement-item" data-requirement="length">
                                                <i class="bi bi-circle me-1 text-muted"></i>
                                                <span class="small">{% trans "At least 8 characters" %}</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="requirement-item" data-requirement="uppercase">
                                                <i class="bi bi-circle me-1 text-muted"></i>
                                                <span class="small">{% trans "One uppercase letter" %}</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="requirement-item" data-requirement="lowercase">
                                                <i class="bi bi-circle me-1 text-muted"></i>
                                                <span class="small">{% trans "One lowercase letter" %}</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="requirement-item" data-requirement="number">
                                                <i class="bi bi-circle me-1 text-muted"></i>
                                                <span class="small">{% trans "One number" %}</span>
                                            </div>
                                        </div>
                                        <div class="col-md-6">
                                            <div class="requirement-item" data-requirement="special">
                                                <i class="bi bi-circle me-1 text-muted"></i>
                                                <span class="small">{% trans "One special character" %}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Confirm New Password -->
                            <div class="col-12">
                                <label for="{{ form.new_password2.id_for_label }}" class="form-label fw-semibold">
                                    {% trans "Confirm New Password" %} *
                                </label>
                                <div class="input-group">
                                    <span class="input-group-text bg-light border-end-0">
                                        <i class="bi bi-key-fill text-muted"></i>
                                    </span>
                                    <input type="password" 
                                           class="form-control {% if form.new_password2.errors %}is-invalid{% endif %} border-start-0" 
                                           id="{{ form.new_password2.id_for_label }}"
                                           name="{{ form.new_password2.name }}"
                                           placeholder="{% trans 'Re-enter your new password' %}"
                                           required
                                           autocomplete="new-password">
                                    <button type="button" class="input-group-text border-start-0 toggle-password" data-target="{{ form.new_password2.id_for_label }}">
                                        <i class="bi bi-eye text-muted"></i>
                                    </button>
                                </div>
                                {% if form.new_password2.errors %}
                                <div class="invalid-feedback d-block">
                                    {{ form.new_password2.errors.0 }}
                                </div>
                                {% endif %}
                                <div class="form-text">
                                    <i class="bi bi-shield-check me-1"></i>
                                    {% trans "Re-enter your new password to confirm" %}
                                </div>

                                <!-- Password Match Indicator -->
                                <div class="password-match-indicator mt-2" style="display: none;">
                                    <small class="text-success">
                                        <i class="bi bi-check-circle-fill me-1"></i>
                                        <span id="passwordMatchText">{% trans "Passwords match" %}</span>
                                    </small>
                                </div>
                            </div>
                        </div>

                        <!-- Additional Security Options -->
                        <div class="security-options mt-4 pt-3 border-top">
                            <h6 class="fw-semibold mb-3">{% trans "Security Options" %}</h6>
                            
                            <div class="form-check mb-2">
                                <input class="form-check-input" type="checkbox" id="logoutOtherDevices" name="logout_other_devices" checked>
                                <label class="form-check-label" for="logoutOtherDevices">
                                    <span class="fw-semibold">{% trans "Log out from all other devices" %}</span>
                                    <small class="d-block text-muted">
                                        {% trans "For security, this will log you out from all other active sessions except this one." %}
                                    </small>
                                </label>
                            </div>

                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="updatePasswordRecovery" name="update_password_recovery" checked>
                                <label class="form-check-label" for="updatePasswordRecovery">
                                    <span class="fw-semibold">{% trans "Update password recovery options" %}</span>
                                    <small class="d-block text-muted">
                                        {% trans "Ensure your password recovery email and security questions are up to date." %}
                                    </small>
                                </label>
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div class="action-buttons mt-4 pt-3 border-top">
                            <div class="row g-2">
                                <div class="col-md-6">
                                    <button type="submit" class="btn btn-primary btn-lg w-100" id="submitButton">
                                        <span class="spinner-border spinner-border-sm me-2 d-none" role="status"></span>
                                        <span class="btn-text">
                                            <i class="bi bi-shield-check me-1"></i>
                                            {% trans "Update Password" %}
                                        </span>
                                    </button>
                                </div>
                                <div class="col-md-6">
                                    <a href="{% url 'users:profile' %}" class="btn btn-outline-secondary btn-lg w-100">
                                        <i class="bi bi-arrow-left me-1"></i>
                                        {% trans "Back to Profile" %}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </form>
                </div>

                <!-- Password History & Tips -->
                <div class="card-footer bg-light border-0">
                    <div class="row">
                        <div class="col-md-6">
                            <h6 class="fw-semibold mb-2">{% trans "Password History" %}</h6>
                            <p class="small text-muted mb-0">
                                {% trans "Last changed:" %}
                                <span class="fw-semibold">
                                    {% if last_changed_time %}
                                        {{ last_changed_time|timesince }} ago
                                    {% else %}
                                        {% trans "never" %}
                                    {% endif %}
                                </span>
                            </p>
                        </div>
                        <div class="col-md-6 text-md-end">
                            <h6 class="fw-semibold mb-2">{% trans "Need Help?" %}</h6>
                            <a href="{% url 'support:contact' %}" class="small text-decoration-none">
                                <i class="bi bi-headset me-1"></i>
                                {% trans "Contact Support" %}
                            </a>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Security Tips Card -->
            <div class="card border-0 shadow-sm mt-4">
                <div class="card-body">
                    <h5 class="fw-bold mb-3">
                        <i class="bi bi-lightbulb text-warning me-2"></i>
                        {% trans "Password Security Tips" %}
                    </h5>
                    <div class="row g-3">
                        <div class="col-md-6">
                            <div class="d-flex">
                                <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                                <div>
                                    <h6 class="fw-semibold mb-1">{% trans "Use a Passphrase" %}</h6>
                                    <p class="small text-muted mb-0">
                                        {% trans "Combine multiple words with numbers and symbols for a strong, memorable password." %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex">
                                <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                                <div>
                                    <h6 class="fw-semibold mb-1">{% trans "Avoid Personal Info" %}</h6>
                                    <p class="small text-muted mb-0">
                                        {% trans "Don't use names, birthdays, or common words that are easy to guess." %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex">
                                <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                                <div>
                                    <h6 class="fw-semibold mb-1">{% trans "Unique for Each Account" %}</h6>
                                    <p class="small text-muted mb-0">
                                        {% trans "Use different passwords for different accounts to limit security breaches." %}
                                    </p>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6">
                            <div class="d-flex">
                                <i class="bi bi-check-circle-fill text-success me-2 mt-1"></i>
                                <div>
                                    <h6 class="fw-semibold mb-1">{% trans "Consider a Password Manager" %}</h6>
                                    <p class="small text-muted mb-0">
                                        {% trans "Use a password manager to generate and store strong, unique passwords securely." %}
                                    </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Success Modal -->
<div class="modal fade" id="successModal" tabindex="-1" aria-labelledby="successModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header border-0">
                <h5 class="modal-title text-success" id="successModalLabel">
                    <i class="bi bi-check-circle-fill me-2"></i>
                    {% trans "Password Updated" %}
                </h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body text-center py-4">
                <div class="success-icon mb-3">
                    <i class="bi bi-shield-check text-success" style="font-size: 3rem;"></i>
                </div>
                <h4 class="fw-bold text-success mb-3">{% trans "Password Changed Successfully!" %}</h4>
                <p class="text-muted mb-4">
                    {% trans "Your password has been updated successfully. For security reasons, you may need to log in again on other devices." %}
                </p>
            </div>
            <div class="modal-footer border-0 justify-content-center">
                <a href="{% url 'users:profile' %}" class="btn btn-primary">
                    <i class="bi bi-person me-1"></i>
                    {% trans "Back to Profile" %}
                </a>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">
                    {% trans "Close" %}
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.password-change-page {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    min-height: 100vh;
}

.card {
    border-radius: 1rem;
    overflow: hidden;
}

.card-header {
    border-radius: 1rem 1rem 0 0 !important;
}

/* Form Styles */
.form-control {
    border-radius: 0.5rem;
    padding: 0.75rem 1rem;
    transition: all 0.3s ease;
}

.form-control:focus {
    box-shadow: 0 0 0 0.2rem rgba(13, 110, 253, 0.15);
    border-color: #0d6efd;
}

.input-group-text {
    border-radius: 0.5rem;
    transition: all 0.3s ease;
}

.toggle-password {
    cursor: pointer;
    background: #f8f9fa;
    border: 1px solid #ced4da;
    border-left: none;
}

.toggle-password:hover {
    background: #e9ecef;
}

/* Password Strength Meter */
.progress {
    border-radius: 3px;
    background-color: #e9ecef;
}

.progress-bar {
    border-radius: 3px;
    transition: width 0.3s ease;
}

/* Requirement Items */
.requirement-item {
    transition: all 0.3s ease;
}

.requirement-item.valid {
    color: #198754;
}

.requirement-item.valid i {
    color: #198754;
}

.requirement-item.invalid {
    color: #6c757d;
}

/* Security Options */
.security-options .form-check-label {
    cursor: pointer;
}

.security-options .form-check-input:checked {
    background-color: #0d6efd;
    border-color: #0d6efd;
}

/* Button Styles */
.btn {
    border-radius: 0.5rem;
    font-weight: 600;
    transition: all 0.3s ease;
}

.btn-primary:hover {
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(13, 110, 253, 0.3);
}

/* Loading State */
.btn-loading .spinner-border {
    display: inline-block !important;
}

.btn-loading .btn-text {
    opacity: 0.7;
}

/* Animations */
@keyframes fadeIn {
    from { opacity: 0; transform: translateY(10px); }
    to { opacity: 1; transform: translateY(0); }
}

.card {
    animation: fadeIn 0.6s ease-out;
}

/* Success Modal */
.modal-content {
    border-radius: 1rem;
    border: none;
}

.success-icon {
    animation: bounceIn 0.6s ease-out;
}

@keyframes bounceIn {
    0% { transform: scale(0.3); opacity: 0; }
    50% { transform: scale(1.05); }
    70% { transform: scale(0.9); }
    100% { transform: scale(1); opacity: 1; }
}

/* Dark Theme Support */
[data-bs-theme="dark"] .password-change-page {
    background: linear-gradient(135deg, #212529 0%, #343a40 100%);
}

[data-bs-theme="dark"] .card {
    background-color: #343a40;
    color: #fff;
}

[data-bs-theme="dark"] .form-control {
    background-color: #495057;
    border-color: #6c757d;
    color: #fff;
}

[data-bs-theme="dark"] .form-control:focus {
    background-color: #495057;
    border-color: #0d6efd;
    color: #fff;
}

[data-bs-theme="dark"] .input-group-text {
    background-color: #495057;
    border-color: #6c757d;
    color: #adb5bd;
}

[data-bs-theme="dark"] .text-muted {
    color: #adb5bd !important;
}

[data-bs-theme="dark"] .card-footer.bg-light {
    background-color: #495057 !important;
}

[data-bs-theme="dark"] .progress {
    background-color: #495057;
}

/* Responsive Design */
@media (max-width: 768px) {
    .password-change-page {
        padding: 1rem 0;
    }
    
    .card-body {
        padding: 1.5rem;
    }
    
    .action-buttons .btn {
        margin-bottom: 0.5rem;
    }
}

/* Accessibility */
@media (prefers-reduced-motion: reduce) {
    .card,
    .form-control,
    .btn,
    .progress-bar,
    .requirement-item {
        transition: none;
        animation: none;
    }
}

/* Print Styles */
@media print {
    .btn,
    .card-footer,
    .security-options {
        display: none !important;
    }
    
    .card {
        box-shadow: none !important;
        border: 1px solid #dee2e6 !important;
    }
}
</style>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('passwordChangeForm');
    const newPasswordInput = document.getElementById('{{ form.new_password1.id_for_label }}');
    const confirmPasswordInput = document.getElementById('{{ form.new_password2.id_for_label }}');
    const strengthMeter = document.querySelector('.password-strength-meter');
    const strengthBar = document.getElementById('passwordStrengthBar');
    const strengthText = document.getElementById('passwordStrengthText');
    const requirements = document.querySelectorAll('.requirement-item');
    const matchIndicator = document.querySelector('.password-match-indicator');
    const matchText = document.getElementById('passwordMatchText');
    const submitButton = document.getElementById('submitButton');

    // Toggle password visibility
    document.querySelectorAll('.toggle-password').forEach(button => {
        button.addEventListener('click', function() {
            const targetId = this.getAttribute('data-target');
            const targetInput = document.getElementById(targetId);
            const icon = this.querySelector('i');
            
            if (targetInput.type === 'password') {
                targetInput.type = 'text';
                icon.classList.remove('bi-eye');
                icon.classList.add('bi-eye-slash');
            } else {
                targetInput.type = 'password';
                icon.classList.remove('bi-eye-slash');
                icon.classList.add('bi-eye');
            }
        });
    });

    // Password strength checker
    if (newPasswordInput) {
        newPasswordInput.addEventListener('input', function() {
            const password = this.value;
            checkPasswordStrength(password);
            validatePasswordRequirements(password);
            checkPasswordMatch();
            
            // Show/hide strength meter
            if (password.length > 0) {
                strengthMeter.style.display = 'block';
            } else {
                strengthMeter.style.display = 'none';
            }
        });
    }

    // Confirm password match checker
    if (confirmPasswordInput) {
        confirmPasswordInput.addEventListener('input', checkPasswordMatch);
    }

    function checkPasswordStrength(password) {
        let strength = 0;
        let feedback = '';

        // Length check
        if (password.length >= 8) strength += 25;
        if (password.length >= 12) strength += 15;

        // Character variety checks
        if (/[A-Z]/.test(password)) strength += 20;
        if (/[a-z]/.test(password)) strength += 20;
        if (/[0-9]/.test(password)) strength += 20;
        if (/[^A-Za-z0-9]/.test(password)) strength += 20;

        // Cap at 100
        strength = Math.min(strength, 100);

        // Update progress bar and text
        strengthBar.style.width = strength + '%';
        
        // Set color and text based on strength
        if (strength < 40) {
            strengthBar.className = 'progress-bar bg-danger';
            strengthText.textContent = '{% trans "Weak" %}';
            strengthText.className = 'small text-danger';
        } else if (strength < 70) {
            strengthBar.className = 'progress-bar bg-warning';
            strengthText.textContent = '{% trans "Fair" %}';
            strengthText.className = 'small text-warning';
        } else if (strength < 90) {
            strengthBar.className = 'progress-bar bg-info';
            strengthText.textContent = '{% trans "Good" %}';
            strengthText.className = 'small text-info';
        } else {
            strengthBar.className = 'progress-bar bg-success';
            strengthText.textContent = '{% trans "Strong" %}';
            strengthText.className = 'small text-success';
        }
    }

    function validatePasswordRequirements(password) {
        const requirementsMap = {
            length: password.length >= 8,
            uppercase: /[A-Z]/.test(password),
            lowercase: /[a-z]/.test(password),
            number: /[0-9]/.test(password),
            special: /[^A-Za-z0-9]/.test(password)
        };

        requirements.forEach(req => {
            const requirement = req.getAttribute('data-requirement');
            const icon = req.querySelector('i');
            
            if (requirementsMap[requirement]) {
                req.classList.add('valid');
                req.classList.remove('invalid');
                icon.className = 'bi bi-check-circle-fill me-1 text-success';
            } else {
                req.classList.add('invalid');
                req.classList.remove('valid');
                icon.className = 'bi bi-circle me-1 text-muted';
            }
        });
    }

    function checkPasswordMatch() {
        const password = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        if (confirmPassword.length === 0) {
            matchIndicator.style.display = 'none';
            return;
        }
        
        if (password === confirmPassword && password.length > 0) {
            matchIndicator.style.display = 'block';
            matchText.innerHTML = '{% trans "Passwords match" %}';
            matchIndicator.querySelector('small').className = 'text-success';
        } else {
            matchIndicator.style.display = 'block';
            matchText.innerHTML = '{% trans "Passwords do not match" %}';
            matchIndicator.querySelector('small').className = 'text-danger';
        }
    }

    // Form submission handling
    form.addEventListener('submit', function(e) {
        const password = newPasswordInput.value;
        const confirmPassword = confirmPasswordInput.value;
        
        // Basic validation
        if (password !== confirmPassword) {
            e.preventDefault();
            showToast('{% trans "Passwords do not match. Please check your entries." %}', 'danger');
            return;
        }
        
        if (password.length < 8) {
            e.preventDefault();
            showToast('{% trans "Password must be at least 8 characters long." %}', 'warning');
            return;
        }
        
        // Show loading state
        submitButton.classList.add('btn-loading');
        submitButton.disabled = true;
        
        // Simulate processing (remove in production)
        setTimeout(() => {
            if (!submitButton.disabled) {
                submitButton.classList.remove('btn-loading');
                submitButton.disabled = false;
            }
        }, 3000);
    });

    // Auto-focus on current password field
    const currentPasswordInput = document.getElementById('{{ form.old_password.id_for_label }}');
    if (currentPasswordInput) {
        currentPasswordInput.focus();
    }

    // Generate strong password suggestion
    function generateStrongPassword() {
        const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789!@#$%^&*';
        let password = '';
        for (let i = 0; i < 12; i++) {
            password += chars.charAt(Math.floor(Math.random() * chars.length));
        }
        return password;
    }

    // Add generate password button (optional feature)
    const generatePasswordButton = document.createElement('button');
    generatePasswordButton.type = 'button';
    generatePasswordButton.className = 'btn btn-outline-info btn-sm mt-2';
    generatePasswordButton.innerHTML = '<i class="bi bi-shuffle me-1"></i>{% trans "Generate Strong Password" %}';
    generatePasswordButton.addEventListener('click', function() {
        const strongPassword = generateStrongPassword();
        newPasswordInput.value = strongPassword;
        confirmPasswordInput.value = strongPassword;
        
        // Trigger validation
        newPasswordInput.dispatchEvent(new Event('input'));
        confirmPasswordInput.dispatchEvent(new Event('input'));
        
        showToast('{% trans "Strong password generated and filled in both fields." %}', 'info');
    });
    
    // Insert generate button after new password field
    const newPasswordGroup = newPasswordInput.closest('.col-12');
    if (newPasswordGroup) {
        newPasswordGroup.appendChild(generatePasswordButton);
    }
});

// Toast notification function
function showToast(message, type = 'info') {
    // Create toast container if it doesn't exist
    let container = document.querySelector('.toast-container');
    if (!container) {
        container = document.createElement('div');
        container.className = 'toast-container position-fixed top-0 end-0 p-3';
        container.style.zIndex = '9999';
        document.body.appendChild(container);
    }
    
    // Create toast
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-white bg-${type} border-0`;
    toast.setAttribute('role', 'alert');
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">${message}</div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast"></button>
        </div>
    `;
    
    container.appendChild(toast);
    
    // Show toast
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    // Remove after hide
    toast.addEventListener('hidden.bs.toast', () => {
        toast.remove();
    });
}

// Check if form was submitted successfully and show success modal
{% if messages %}
    {% for message in messages %}
        {% if message.tags == 'success' %}
        document.addEventListener('DOMContentLoaded', function() {
            const successModal = new bootstrap.Modal(document.getElementById('successModal'));
            successModal.show();
        });
        {% endif %}
    {% endfor %}
{% endif %}
</script>
{% endblock %}
