{% extends 'base.html' %}
{% load static %}
{% load i18n %}
{% load academics_filters %}

{% block title %}{% trans "Super Admin Entity Management" %} - {{ block.super }}{% endblock %}

{% block content %}
<div class="container-fluid">
    <!-- Page Header -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <h1 class="h3 mb-0">
                        <i class="fas fa-users-cog text-warning"></i> {% trans "Super Admin Entity Management" %}
                    </h1>
                    <p class="text-muted">{% trans "Comprehensive view of teachers, students, classes, departments, sessions, and enrollments" %}</p>
                </div>
                <div>
                    <a href="{% url 'core:institution_list' %}" class="btn btn-primary">
                        <i class="fas fa-school"></i> {% trans "Manage Institutions" %}
                    </a>
                    <a href="{% url 'core:super_admin_dashboard' %}" class="btn btn-info">
                        <i class="fas fa-tachometer-alt"></i> {% trans "Dashboard" %}
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Selected Institution Indicator -->
    {% if selected_institution %}
    <div class="row mb-3">
        <div class="col-12">
            <div class="alert alert-info d-flex align-items-center">
                <i class="fas fa-school fa-lg mr-3"></i>
                <div>
                    <strong>{% trans "Currently Managing:" %}</strong> {{ selected_institution.name }} ({{ selected_institution.code }})
                    {% if selected_institution.city %}
                        - {{ selected_institution.city }}{% if selected_institution.country %}, {{ selected_institution.country }}{% endif %}
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Category Filter Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <form method="get" class="d-inline">
                <div class="card-body">
                    <div class="d-flex justify-content-between align-items-center">
                        <div>
                            <h6 class="font-weight-bold text-primary mb-3">
                                <i class="fas fa-filter"></i> {% trans "Filter by Category" %}
                            </h6>
                            <div class="btn-group btn-group-toggle flex-wrap" data-toggle="buttons">
                                <label class="btn btn-outline-primary btn-sm {% if category_filter == 'academics' or not category_filter %}active{% endif %}">
                                    <input type="radio" name="category" value="academics" {% if category_filter == 'academics' or not category_filter %}checked{% endif %}> {% trans "Academics" %}
                                </label>
                                <label class="btn btn-outline-success btn-sm {% if category_filter == 'schools' %}active{% endif %}">
                                    <input type="radio" name="category" value="schools" {% if category_filter == 'schools' %}checked{% endif %}> {% trans "Schools" %}
                                </label>
                                <label class="btn btn-outline-info btn-sm {% if category_filter == 'other' %}active{% endif %}">
                                    <input type="radio" name="category" value="other" {% if category_filter == 'other' %}checked{% endif %}> {% trans "Other" %}
                                </label>
                            </div>
                        </div>
                        <div>
                            <button type="submit" class="btn btn-primary">
                                <i class="fas fa-filter"></i> {% trans "Apply Filter" %}
                            </button>
                        </div>
                    </div>
                </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Filters Section -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-body">
                    <form method="get" class="form-inline">
                        <div class="form-group mr-3">
                            <label for="institution" class="mr-2">{% trans "Select Institution:" %}</label>
                            <select name="institution" id="institution" class="form-control" onchange="this.form.submit()">
                                {% for institution in institutions %}
                                <option value="{{ institution.id }}" {% if selected_institution and selected_institution.id == institution.id %}selected{% endif %}>
                                    {{ institution.name }} ({{ institution.code }})
                                </option>
                                {% endfor %}
                            </select>
                        </div>
                        <div class="form-group mr-3">
                            <label for="search" class="mr-2">{% trans "Search:" %}</label>
                            <input type="text" name="search" id="search" value="{{ search_query }}" class="form-control" placeholder="{% trans 'Search entities...' %}">
                        </div>
                        <button type="submit" class="btn btn-primary mr-2">
                            <i class="fas fa-search"></i> {% trans "Search" %}
                        </button>
                        {% if search_query %}
                        <a href="{% url 'core:super_admin_entities' %}" class="btn btn-secondary">
                            <i class="fas fa-times"></i> {% trans "Clear Filters" %}
                        </a>
                        {% endif %}
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    {% if category_filter == 'academics' or not category_filter %}
    <div class="row mb-4">
        <div class="col-xl-2 col-md-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                {% trans "Students" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.students }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-user-graduate fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-2 col-md-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                {% trans "Teachers" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.teachers }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-chalkboard-teacher fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-2 col-md-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                {% trans "Classes" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.classes }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-2 col-md-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                {% trans "Departments" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.departments }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-building fa-2x text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-2 col-md-4">
            <div class="card border-left-secondary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-secondary text-uppercase mb-1">
                                {% trans "Sessions" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.sessions }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar-alt fa-2x text-secondary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-2 col-md-4">
            <div class="card border-left-danger shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-danger text-uppercase mb-1">
                                {% trans "Enrollments" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.enrollments }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-id-card fa-2x text-danger"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% elif category_filter == 'schools' %}
    <div class="row mb-4">
        <div class="col-xl-4 col-md-6">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                {% trans "Institutions" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.institutions }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-school fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-md-6">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                {% trans "Active Configurations" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.active_configs }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-cogs fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-4 col-md-6">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                {% trans "Total Configurations" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.configs }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-database fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% elif category_filter == 'other' %}
    <div class="row mb-4">
        <div class="col-xl-3 col-md-6">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                {% trans "Users" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.users }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                {% trans "Invoices" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.invoices }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                {% trans "Support Tickets" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.tickets }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-headset fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-xl-3 col-md-6">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                {% trans "Announcements" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">{{ entity_counts.announcements }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-comments fa-2x text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Tabbed Entity Tables -->
    <div class="row">
        <div class="col-12">
            <div class="card shadow">
                <div class="card-header py-3">
                    <ul class="nav nav-tabs card-header-tabs" id="entity-tabs" role="tablist">
                        <li class="nav-item">
                            <a class="nav-link active" id="students-tab" data-toggle="tab" href="#students" role="tab" aria-controls="students" aria-selected="true">
                                <i class="fas fa-user-graduate"></i> {% trans "Students" %}
                                <span class="badge badge-pill badge-primary ml-1">{{ students|length }}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="teachers-tab" data-toggle="tab" href="#teachers" role="tab" aria-controls="teachers" aria-selected="false">
                                <i class="fas fa-chalkboard-teacher"></i> {% trans "Teachers" %}
                                <span class="badge badge-pill badge-success ml-1">{{ teachers|length }}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="classes-tab" data-toggle="tab" href="#classes" role="tab" aria-controls="classes" aria-selected="false">
                                <i class="fas fa-users"></i> {% trans "Classes" %}
                                <span class="badge badge-pill badge-info ml-1">{{ classes|length }}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="departments-tab" data-toggle="tab" href="#departments" role="tab" aria-controls="departments" aria-selected="false">
                                <i class="fas fa-building"></i> {% trans "Departments" %}
                                <span class="badge badge-pill badge-warning ml-1">{{ departments|length }}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="sessions-tab" data-toggle="tab" href="#sessions" role="tab" aria-controls="sessions" aria-selected="false">
                                <i class="fas fa-calendar-alt"></i> {% trans "Sessions" %}
                                <span class="badge badge-pill badge-secondary ml-1">{{ sessions|length }}</span>
                            </a>
                        </li>
                        <li class="nav-item">
                            <a class="nav-link" id="enrollments-tab" data-toggle="tab" href="#enrollments" role="tab" aria-controls="enrollments" aria-selected="false">
                                <i class="fas fa-id-card"></i> {% trans "Enrollments" %}
                                <span class="badge badge-pill badge-danger ml-1">{{ enrollments|length }}</span>
                            </a>
                        </li>
                    </ul>
                </div>
                <div class="card-body">
                    <div class="tab-content" id="entity-tab-content">
                        <!-- Students Tab -->
                        <div class="tab-pane fade show active" id="students" role="tabpanel" aria-labelledby="students-tab">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>{% trans "Student ID" %}</th>
                                            <th>{% trans "Name" %}</th>
                                            <th>{% trans "Email" %}</th>
                                            <th>{% trans "Class" %}</th>
                                            <th>{% trans "Status" %}</th>
                                            <th>{% trans "Admission Date" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for student in students %}
                                        <tr>
                                            <td>{{ student.student_id }}</td>
                                            <td>{{ student.user.get_full_name }}</td>
                                            <td>{{ student.user.email }}</td>
                                            <td>
                                                {% if student.current_class %}
                                                    {{ student.current_class.name }}
                                                {% else %}
                                                    <span class="text-muted">{% trans "Not assigned" %}</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <span class="badge badge-{% if student.status == 'active' %}success{% else %}secondary{% endif %}">
                                                    {{ student.get_status_display|capfirst }}
                                                </span>
                                            </td>
                                            <td>{{ student.admission_date|date:"M d, Y" }}</td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">
                                                <i class="fas fa-user-graduate fa-3x mb-3"></i>
                                                <p>{% trans "No students found matching the current filters." %}</p>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Teachers Tab -->
                        <div class="tab-pane fade" id="teachers" role="tabpanel" aria-labelledby="teachers-tab">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>{% trans "Teacher ID" %}</th>
                                            <th>{% trans "Name" %}</th>
                                            <th>{% trans "Email" %}</th>
                                            <th>{% trans "Department" %}</th>
                                            <th>{% trans "Type" %}</th>
                                            <th>{% trans "Status" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for teacher in teachers %}
                                        <tr>
                                            <td>{{ teacher.teacher_id }}</td>
                                            <td>{{ teacher.user.get_full_name }}</td>
                                            <td>{{ teacher.user.email }}</td>
                                            <td>
                                                {% if teacher.department %}
                                                    {{ teacher.department.name }}
                                                {% else %}
                                                    <span class="text-muted">{% trans "Not assigned" %}</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ teacher.get_teacher_type_display }}</td>
                                            <td>
                                                <span class="badge badge-{% if teacher.status == 'active' %}success{% else %}secondary{% endif %}">
                                                    {{ teacher.get_status_display|capfirst }}
                                                </span>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">
                                                <i class="fas fa-chalkboard-teacher fa-3x mb-3"></i>
                                                <p>{% trans "No teachers found matching the current filters." %}</p>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Classes Tab -->
                        <div class="tab-pane fade" id="classes" role="tabpanel" aria-labelledby="classes-tab">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>{% trans "Class Name" %}</th>
                                            <th>{% trans "Code" %}</th>
                                            <th>{% trans "Grade Level" %}</th>
                                            <th>{% trans "Class Teacher" %}</th>
                                            <th>{% trans "Capacity" %}</th>
                                            <th>{% trans "Enrolled" %}</th>
                                            <th>{% trans "Session" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for class in classes %}
                                        <tr>
                                            <td>{{ class.name }}</td>
                                            <td>{{ class.code }}</td>
                                            <td>{{ class.grade_level.name }}</td>
                                            <td>
                                                {% if class.class_teacher %}
                                                    {{ class.class_teacher.user.get_full_name }}
                                                {% else %}
                                                    <span class="text-muted">{% trans "Not assigned" %}</span>
                                                {% endif %}
                                            </td>
                                            <td>{{ class.capacity }}</td>
                                            <td>{{ class.current_student_count }}</td>
                                            <td>{{ class.academic_session.name }}</td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-4">
                                                <i class="fas fa-users fa-3x mb-3"></i>
                                                <p>{% trans "No classes found matching the current filters." %}</p>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Departments Tab -->
                        <div class="tab-pane fade" id="departments" role="tabpanel" aria-labelledby="departments-tab">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>{% trans "Department Name" %}</th>
                                            <th>{% trans "Code" %}</th>
                                            <th>{% trans "Head of Department" %}</th>
                                            <th>{% trans "Established" %}</th>
                                            <th>{% trans "Description" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for department in departments %}
                                        <tr>
                                            <td>{{ department.name }}</td>
                                            <td>{{ department.code }}</td>
                                            <td>
                                                {% if department.head_of_department %}
                                                    {{ department.head_of_department.user.get_full_name }}
                                                {% else %}
                                                    <span class="text-muted">{% trans "Not assigned" %}</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if department.established_date %}
                                                    {{ department.established_date|date:"M d, Y" }}
                                                {% else %}
                                                    <span class="text-muted">―</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                {% if department.description %}
                                                    {{ department.description|truncatechars:50 }}
                                                {% else %}
                                                    <span class="text-muted">―</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="5" class="text-center text-muted py-4">
                                                <i class="fas fa-building fa-3x mb-3"></i>
                                                <p>{% trans "No departments found matching the current filters." %}</p>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Sessions Tab -->
                        <div class="tab-pane fade" id="sessions" role="tabpanel" aria-labelledby="sessions-tab">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>{% trans "Session Name" %}</th>
                                            <th>{% trans "Start Date" %}</th>
                                            <th>{% trans "End Date" %}</th>
                                            <th>{% trans "Semesters" %}</th>
                                            <th>{% trans "Current" %}</th>
                                            <th>{% trans "Progress" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for session in sessions %}
                                        <tr>
                                            <td>{{ session.name }}</td>
                                            <td>{{ session.start_date|date:"M d, Y" }}</td>
                                            <td>{{ session.end_date|date:"M d, Y" }}</td>
                                            <td>{{ session.number_of_semesters }}</td>
                                            <td>
                                                {% if session.is_current %}
                                                    <span class="badge badge-success">{% trans "Yes" %}</span>
                                                {% else %}
                                                    <span class="badge badge-secondary">{% trans "No" %}</span>
                                                {% endif %}
                                            </td>
                                            <td>
                                                <div class="progress" style="width: 100px;">
                                                    <div class="progress-bar bg-{% if session.progress_percentage < 30 %}danger{% elif session.progress_percentage < 70 %}warning{% else %}success{% endif %} progress-bar-striped"
                                                         role="progressbar"
                                                         style="width: {{ session.progress_percentage }}%"
                                                         aria-valuenow="{{ session.progress_percentage }}"
                                                         aria-valuemin="0"
                                                         aria-valuemax="100">
                                                        {{ session.progress_percentage }}%
                                                    </div>
                                                </div>
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="6" class="text-center text-muted py-4">
                                                <i class="fas fa-calendar-alt fa-3x mb-3"></i>
                                                <p>{% trans "No sessions found matching the current filters." %}</p>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Enrollments Tab -->
                        <div class="tab-pane fade" id="enrollments" role="tabpanel" aria-labelledby="enrollments-tab">
                            <div class="table-responsive">
                                <table class="table table-striped table-hover">
                                    <thead>
                                        <tr>
                                            <th>{% trans "Student" %}</th>
                                            <th>{% trans "Class" %}</th>
                                            <th>{% trans "Roll Number" %}</th>
                                            <th>{% trans "Session" %}</th>
                                            <th>{% trans "Status" %}</th>
                                            <th>{% trans "Enrollment Date" %}</th>
                                            <th>{% trans "Remarks" %}</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {% for enrollment in enrollments %}
                                        <tr>
                                            <td>{{ enrollment.student.user.get_full_name }}</td>
                                            <td>{{ enrollment.class_enrolled.name }}</td>
                                            <td>{{ enrollment.roll_number }}</td>
                                            <td>{{ enrollment.academic_session.name }}</td>
                                            <td>
                                                <span class="badge badge-{% if enrollment.enrollment_status == 'active' %}success{% else %}secondary{% endif %}">
                                                    {{ enrollment.get_enrollment_status_display }}
                                                </span>
                                            </td>
                                            <td>{{ enrollment.enrollment_date|date:"M d, Y" }}</td>
                                            <td>
                                                {% if enrollment.remarks %}
                                                    {{ enrollment.remarks|truncatechars:30 }}
                                                {% else %}
                                                    <span class="text-muted">―</span>
                                                {% endif %}
                                            </td>
                                        </tr>
                                        {% empty %}
                                        <tr>
                                            <td colspan="7" class="text-center text-muted py-4">
                                                <i class="fas fa-id-card fa-3x mb-3"></i>
                                                <p>{% trans "No enrollments found matching the current filters." %}</p>
                                            </td>
                                        </tr>
                                        {% endfor %}
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<style>
.border-left-primary {
    border-left: 0.25rem solid #4e73df !important;
}
.border-left-success {
    border-left: 0.25rem solid #1cc88a !important;
}
.border-left-info {
    border-left: 0.25rem solid #36b9cc !important;
}
.border-left-warning {
    border-left: 0.25rem solid #f6c23e !important;
}
.border-left-secondary {
    border-left: 0.25rem solid #858796 !important;
}
.border-left-danger {
    border-left: 0.25rem solid #e74a3b !important;
}

.table-responsive {
    max-height: 600px;
    overflow-y: auto;
}

.progress {
    height: 20px;
}

.progress-bar {
    font-size: 0.75rem;
    line-height: 1.2;
}

.badge {
    font-size: 0.75rem;
}
</style>
{% endblock %}

{% block extra_js %}
<script>
$(document).ready(function() {
    // Initialize Bootstrap tabs
    $('#entity-tabs a').on('click', function (e) {
        e.preventDefault();
        $(this).tab('show');
    });

    // Auto-submit institution filter on change
    $('#institution').change(function() {
        $(this).closest('form').submit();
    });

    // Search on enter key
    $('#search').keypress(function(e) {
        if (e.which == 13) {
            $(this).closest('form').submit();
        }
    });
});
</script>
{% endblock %}
