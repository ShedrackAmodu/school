{% extends 'base.html' %}
{% load static %}

{% block title %}Communication Dashboard{% endblock %}

{% block extra_css %}
<style>
.dashboard-container {
    max-width: 1400px;
    margin: 0 auto;
}

/* Stats Cards */
.stats-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.stat-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
    position: relative;
    overflow: hidden;
}

.stat-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}

.stat-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 4px;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.stat-card.primary::before { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.stat-card.success::before { background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); }
.stat-card.warning::before { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.stat-card.danger::before { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }

.stat-content {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
}

.stat-info {
    flex: 1;
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    color: #2c3e50;
    line-height: 1;
    margin-bottom: 0.5rem;
}

.stat-label {
    color: #6c757d;
    font-weight: 500;
    margin-bottom: 0.5rem;
}

.stat-change {
    display: flex;
    align-items: center;
    gap: 0.25rem;
    font-size: 0.875rem;
    font-weight: 500;
}

.change-positive { color: #28a745; }
.change-negative { color: #dc3545; }
.change-neutral { color: #6c757d; }

.stat-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
}

.stat-icon.primary { background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); }
.stat-icon.success { background: linear-gradient(135deg, #4ecdc4 0%, #44a08d 100%); }
.stat-icon.warning { background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); }
.stat-icon.danger { background: linear-gradient(135deg, #fa709a 0%, #fee140 100%); }

/* Dashboard Grid */
.dashboard-grid {
    display: grid;
    grid-template-columns: 2fr 1fr;
    gap: 2rem;
    margin-bottom: 2rem;
}

@media (max-width: 1200px) {
    .dashboard-grid {
        grid-template-columns: 1fr;
    }
}

/* Quick Actions */
.quick-actions-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    margin-bottom: 2rem;
}

.quick-action-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    text-align: center;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    border: 1px solid #e9ecef;
    transition: all 0.3s ease;
    text-decoration: none;
    color: inherit;
}

.quick-action-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    color: inherit;
    text-decoration: none;
}

.action-icon {
    width: 60px;
    height: 60px;
    border-radius: 12px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.5rem;
    color: white;
    margin: 0 auto 1rem;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.action-title {
    font-weight: 600;
    color: #2c3e50;
    margin-bottom: 0.5rem;
}

.action-description {
    color: #6c757d;
    font-size: 0.875rem;
}

/* Activity Feed */
.activity-feed {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    border: 1px solid #e9ecef;
}

.activity-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e9ecef;
}

.activity-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2c3e50;
    margin: 0;
}

.activity-item {
    display: flex;
    gap: 1rem;
    padding: 1rem 0;
    border-bottom: 1px solid #f8f9fa;
}

.activity-item:last-child {
    border-bottom: none;
}

.activity-icon {
    width: 40px;
    height: 40px;
    border-radius: 10px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1rem;
    color: white;
    flex-shrink: 0;
}

.activity-icon.announcement { background: #3498db; }
.activity-icon.message { background: #9b59b6; }
.activity-icon.email { background: #e74c3c; }
.activity-icon.sms { background: #2ecc71; }

.activity-content {
    flex: 1;
}

.activity-message {
    color: #2c3e50;
    margin-bottom: 0.25rem;
}

.activity-time {
    color: #6c757d;
    font-size: 0.875rem;
}

/* Charts Section */
.charts-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
    gap: 1.5rem;
    margin-bottom: 2rem;
}

.chart-card {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    border: 1px solid #e9ecef;
}

.chart-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 1rem;
}

.chart-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: #2c3e50;
    margin: 0;
}

.chart-container {
    position: relative;
    height: 300px;
}

/* Priority Distribution */
.priority-distribution {
    display: grid;
    gap: 1rem;
}

.priority-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 0.75rem;
    border-radius: 8px;
    background: #f8f9fa;
}

.priority-info {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.priority-dot {
    width: 12px;
    height: 12px;
    border-radius: 50%;
}

.priority-dot.urgent { background: #dc3545; }
.priority-dot.high { background: #fd7e14; }
.priority-dot.normal { background: #20c997; }
.priority-dot.low { background: #6c757d; }

.priority-count {
    font-weight: 600;
    color: #2c3e50;
}

/* Recent Items */
.recent-section {
    background: white;
    border-radius: 12px;
    padding: 1.5rem;
    box-shadow: 0 2px 10px rgba(0,0,0,0.05);
    border: 1px solid #e9ecef;
    margin-bottom: 2rem;
}

.recent-header {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 1.5rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid #e9ecef;
}

.recent-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: #2c3e50;
    margin: 0;
}

.recent-item {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1rem;
    border-radius: 8px;
    margin-bottom: 0.5rem;
    transition: background-color 0.2s;
}

.recent-item:hover {
    background: #f8f9fa;
}

.recent-item-content {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex: 1;
}

.recent-icon {
    width: 40px;
    height: 40px;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: white;
    font-size: 1rem;
}

.recent-icon.announcement { background: #3498db; }
.recent-icon.message { background: #9b59b6; }
.recent-icon.email { background: #e74c3c; }

.recent-text {
    flex: 1;
}

.recent-title-text {
    font-weight: 500;
    color: #2c3e50;
    margin-bottom: 0.25rem;
}

.recent-meta {
    color: #6c757d;
    font-size: 0.875rem;
}

.recent-time {
    color: #6c757d;
    font-size: 0.875rem;
    white-space: nowrap;
}

/* Empty States */
.empty-state {
    text-align: center;
    padding: 3rem 2rem;
    color: #6c757d;
}

.empty-state-icon {
    font-size: 4rem;
    color: #dee2e6;
    margin-bottom: 1rem;
}

.empty-state h3 {
    color: #6c757d;
    margin-bottom: 0.5rem;
}

/* Loading States */
.loading-skeleton {
    animation: pulse 1.5s ease-in-out infinite;
}

.skeleton-card {
    background: #f8f9fa;
    border-radius: 12px;
    padding: 1.5rem;
    margin-bottom: 1.5rem;
    height: 120px;
}

/* Responsive Design */
@media (max-width: 768px) {
    .stats-grid {
        grid-template-columns: 1fr;
    }
    
    .quick-actions-grid {
        grid-template-columns: 1fr;
    }
    
    .charts-grid {
        grid-template-columns: 1fr;
    }
    
    .dashboard-grid {
        gap: 1rem;
    }
    
    .activity-item {
        flex-direction: column;
        gap: 0.5rem;
    }
    
    .recent-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.5rem;
    }
    
    .recent-time {
        align-self: flex-end;
    }
}

/* Dark mode support */
[data-bs-theme="dark"] .stat-card,
[data-bs-theme="dark"] .quick-action-card,
[data-bs-theme="dark"] .activity-feed,
[data-bs-theme="dark"] .chart-card,
[data-bs-theme="dark"] .recent-section {
    background: #2d3748;
    border-color: #4a5568;
    color: #e2e8f0;
}

[data-bs-theme="dark"] .stat-number {
    color: #e2e8f0;
}

[data-bs-theme="dark"] .stat-label,
[data-bs-theme="dark"] .action-description,
[data-bs-theme="dark"] .activity-time,
[data-bs-theme="dark"] .recent-meta,
[data-bs-theme="dark"] .recent-time {
    color: #a0aec0;
}

[data-bs-theme="dark"] .priority-item {
    background: #4a5568;
}

[data-bs-theme="dark"] .recent-item:hover {
    background: #4a5568;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid dashboard-container">
    <!-- Page Header -->
    <div class="page-header bg-light py-4 mb-4">
        <div class="container-fluid">
            <div class="row align-items-center">
                <div class="col">
                    <h1 class="page-title h2 mb-2">
                        <i class="bi bi-chat-dots text-primary me-2"></i>
                        Communication Dashboard
                    </h1>
                    <p class="text-muted mb-0">
                        Overview of all communication activities and metrics
                    </p>
                </div>
                <div class="col-auto">
                    <div class="btn-group">
                        <button class="btn btn-outline-primary btn-sm" id="refreshDashboard">
                            <i class="bi bi-arrow-clockwise me-2"></i>
                            Refresh
                        </button>
                        <button class="btn btn-outline-secondary btn-sm" onclick="window.print()">
                            <i class="bi bi-printer me-2"></i>
                            Print
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Statistics Cards -->
    <div class="stats-grid">
        <!-- Unread Messages -->
        <div class="stat-card primary">
            <div class="stat-content">
                <div class="stat-info">
                    <div class="stat-number">{{ unread_count }}</div>
                    <div class="stat-label">Unread Messages</div>
                    <div class="stat-change change-negative">
                        <i class="bi bi-arrow-up"></i>
                        12% from last week
                    </div>
                </div>
                <div class="stat-icon primary">
                    <i class="bi bi-envelope"></i>
                </div>
            </div>
        </div>

        <!-- Sent Messages -->
        <div class="stat-card success">
            <div class="stat-content">
                <div class="stat-info">
                    <div class="stat-number">{{ sent_count }}</div>
                    <div class="stat-label">Messages Sent</div>
                    <div class="stat-change change-positive">
                        <i class="bi bi-arrow-up"></i>
                        8% from last week
                    </div>
                </div>
                <div class="stat-icon success">
                    <i class="bi bi-send"></i>
                </div>
            </div>
        </div>

        <!-- Announcements -->
        <div class="stat-card warning">
            <div class="stat-content">
                <div class="stat-info">
                    <div class="stat-number">{{ announcement_count }}</div>
                    <div class="stat-label">Active Announcements</div>
                    <div class="stat-change change-positive">
                        <i class="bi bi-arrow-up"></i>
                        5% from last week
                    </div>
                </div>
                <div class="stat-icon warning">
                    <i class="bi bi-megaphone"></i>
                </div>
            </div>
        </div>

        <!-- Pending Confirmations -->
        {% if 'communication.view_analytics' in perms %}
        <div class="stat-card danger">
            <div class="stat-content">
                <div class="stat-info">
                    <div class="stat-number">{{ pending_confirmations }}</div>
                    <div class="stat-label">Pending Confirmations</div>
                    <div class="stat-change change-negative">
                        <i class="bi bi-arrow-up"></i>
                        15% from last week
                    </div>
                </div>
                <div class="stat-icon danger">
                    <i class="bi bi-clock-history"></i>
                </div>
            </div>
        </div>
        {% endif %}
    </div>

    <!-- Quick Actions -->
    <div class="quick-actions-grid">
        <a href="{% url 'communication:announcement_create' %}" class="quick-action-card">
            <div class="action-icon">
                <i class="bi bi-plus-circle"></i>
            </div>
            <div class="action-title">Create Announcement</div>
            <div class="action-description">Post a new announcement to your audience</div>
        </a>

        <a href="{% url 'communication:message_create' %}" class="quick-action-card">
            <div class="action-icon">
                <i class="bi bi-send"></i>
            </div>
            <div class="action-title">Send Message</div>
            <div class="action-description">Compose and send a new message</div>
        </a>

        <a href="{% url 'communication:inbox' %}" class="quick-action-card">
            <div class="action-icon">
                <i class="bi bi-inbox"></i>
            </div>
            <div class="action-title">Check Inbox</div>
            <div class="action-description">View your received messages</div>
        </a>

        <a href="{% url 'communication:emailtemplate_create' %}" class="quick-action-card">
            <div class="action-icon">
                <i class="bi bi-envelope-plus"></i>
            </div>
            <div class="action-title">Email Template</div>
            <div class="action-description">Create a new email template</div>
        </a>
    </div>

    <div class="dashboard-grid">
        <!-- Left Column -->
        <div class="left-column">
            <!-- Activity Feed -->
            <div class="activity-feed">
                <div class="activity-header">
                    <h3 class="activity-title">Recent Activity</h3>
                    <a href="#" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                
                <div class="activity-list">
                    <!-- Sample Activity Items -->
                    <div class="activity-item">
                        <div class="activity-icon announcement">
                            <i class="bi bi-megaphone"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-message">
                                New announcement "School Holiday Schedule" was published
                            </div>
                            <div class="activity-time">2 hours ago</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon message">
                            <i class="bi bi-chat-dots"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-message">
                                You received a new message from John Smith
                            </div>
                            <div class="activity-time">4 hours ago</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon email">
                            <i class="bi bi-envelope"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-message">
                                Bulk email sent to all parents - 234 delivered
                            </div>
                            <div class="activity-time">1 day ago</div>
                        </div>
                    </div>
                    
                    <div class="activity-item">
                        <div class="activity-icon sms">
                            <i class="bi bi-chat-text"></i>
                        </div>
                        <div class="activity-content">
                            <div class="activity-message">
                                SMS notification sent for urgent announcement
                            </div>
                            <div class="activity-time">2 days ago</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Charts Section -->
            <div class="charts-grid">
                <!-- Message Statistics Chart -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Message Statistics</h4>
                        <select class="form-select form-select-sm" style="width: auto;">
                            <option>Last 7 days</option>
                            <option>Last 30 days</option>
                            <option>Last 90 days</option>
                        </select>
                    </div>
                    <div class="chart-container">
                        <canvas id="messageStatsChart"></canvas>
                    </div>
                </div>

                <!-- Announcement Types -->
                <div class="chart-card">
                    <div class="chart-header">
                        <h4 class="chart-title">Announcement Types</h4>
                    </div>
                    <div class="chart-container">
                        <canvas id="announcementTypesChart"></canvas>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column -->
        <div class="right-column">
            <!-- Priority Distribution -->
            <div class="chart-card">
                <div class="chart-header">
                    <h4 class="chart-title">Priority Distribution</h4>
                </div>
                <div class="priority-distribution">
                    <div class="priority-item">
                        <div class="priority-info">
                            <div class="priority-dot urgent"></div>
                            <span>Urgent</span>
                        </div>
                        <div class="priority-count">12</div>
                    </div>
                    <div class="priority-item">
                        <div class="priority-info">
                            <div class="priority-dot high"></div>
                            <span>High</span>
                        </div>
                        <div class="priority-count">28</div>
                    </div>
                    <div class="priority-item">
                        <div class="priority-info">
                            <div class="priority-dot normal"></div>
                            <span>Normal</span>
                        </div>
                        <div class="priority-count">156</div>
                    </div>
                    <div class="priority-item">
                        <div class="priority-info">
                            <div class="priority-dot low"></div>
                            <span>Low</span>
                        </div>
                        <div class="priority-count">43</div>
                    </div>
                </div>
            </div>

            <!-- Recent Announcements -->
            <div class="recent-section">
                <div class="recent-header">
                    <h3 class="recent-title">Recent Announcements</h3>
                    <a href="{% url 'communication:announcement_list' %}" class="btn btn-sm btn-outline-primary">View All</a>
                </div>
                
                <div class="recent-list">
                    <!-- Sample Recent Items -->
                    <div class="recent-item">
                        <div class="recent-item-content">
                            <div class="recent-icon announcement">
                                <i class="bi bi-megaphone"></i>
                            </div>
                            <div class="recent-text">
                                <div class="recent-title-text">School Holiday Schedule</div>
                                <div class="recent-meta">General • Published 2 hours ago</div>
                            </div>
                        </div>
                        <div class="recent-time">2h ago</div>
                    </div>
                    
                    <div class="recent-item">
                        <div class="recent-item-content">
                            <div class="recent-icon announcement">
                                <i class="bi bi-megaphone"></i>
                            </div>
                            <div class="recent-text">
                                <div class="recent-title-text">CBT Time Table Updates</div>
                                <div class="recent-meta">Academic • Published 1 day ago</div>
                            </div>
                        </div>
                        <div class="recent-time">1d ago</div>
                    </div>
                    
                    <div class="recent-item">
                        <div class="recent-item-content">
                            <div class="recent-icon announcement">
                                <i class="bi bi-megaphone"></i>
                            </div>
                            <div class="recent-text">
                                <div class="recent-title-text">Fee Payment Reminder</div>
                                <div class="recent-meta">Fee Related • Published 2 days ago</div>
                            </div>
                        </div>
                        <div class="recent-time">2d ago</div>
                    </div>
                </div>
            </div>

            <!-- System Status -->
            <div class="chart-card">
                <div class="chart-header">
                    <h4 class="chart-title">System Status</h4>
                </div>
                <div class="system-status">
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>Email Service</span>
                        <span class="badge bg-success">Operational</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>SMS Gateway</span>
                        <span class="badge bg-success">Operational</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center mb-3">
                        <span>Notification System</span>
                        <span class="badge bg-warning">Maintenance</span>
                    </div>
                    <div class="d-flex justify-content-between align-items-center">
                        <span>Database</span>
                        <span class="badge bg-success">Operational</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Only Section -->
    {% if 'communication.view_analytics' in perms %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="chart-card">
                <div class="chart-header">
                    <h4 class="chart-title">Communication Analytics</h4>
                    <select class="form-select form-select-sm" style="width: auto;">
                        <option>Last 30 days</option>
                        <option>Last 90 days</option>
                        <option>This year</option>
                    </select>
                </div>
                <div class="row">
                    <div class="col-md-3 text-center">
                        <div class="h3 text-primary">{{ total_messages_sent }}</div>
                        <div class="text-muted">Total Messages</div>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="h3 text-success">{{ total_announcements }}</div>
                        <div class="text-muted">Total Announcements</div>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="h3 text-warning">{{ pending_confirmations }}</div>
                        <div class="text-muted">Pending Confirmations</div>
                    </div>
                    <div class="col-md-3 text-center">
                        <div class="h3 text-info">98.2%</div>
                        <div class="text-muted">Delivery Rate</div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Initialize charts
    initializeCharts();
    
    // Refresh dashboard functionality
    const refreshBtn = document.getElementById('refreshDashboard');
    if (refreshBtn) {
        refreshBtn.addEventListener('click', function() {
            const icon = this.querySelector('i');
            const originalClass = icon.className;
            
            // Add spinning animation
            icon.className = 'bi bi-arrow-clockwise me-2 spin';
            
            // Simulate refresh delay
            setTimeout(() => {
                icon.className = originalClass;
                initializeCharts(); // Reinitialize charts
                showToast('Dashboard refreshed successfully', 'success');
            }, 1000);
        });
    }
    
    // Auto-refresh every 5 minutes
    setInterval(() => {
        initializeCharts();
    }, 300000);
});

function initializeCharts() {
    // Message Statistics Chart
    const messageStatsCtx = document.getElementById('messageStatsChart');
    if (messageStatsCtx) {
        new Chart(messageStatsCtx, {
            type: 'line',
            data: {
                labels: ['Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat', 'Sun'],
                datasets: [
                    {
                        label: 'Messages Sent',
                        data: [12, 19, 8, 15, 22, 18, 25],
                        borderColor: '#3498db',
                        backgroundColor: 'rgba(52, 152, 219, 0.1)',
                        tension: 0.4,
                        fill: true
                    },
                    {
                        label: 'Messages Received',
                        data: [8, 12, 6, 10, 15, 12, 18],
                        borderColor: '#9b59b6',
                        backgroundColor: 'rgba(155, 89, 182, 0.1)',
                        tension: 0.4,
                        fill: true
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'top',
                    },
                    tooltip: {
                        mode: 'index',
                        intersect: false
                    }
                },
                scales: {
                    y: {
                        beginAtZero: true,
                        ticks: {
                            stepSize: 5
                        }
                    }
                }
            }
        });
    }
    
    // Announcement Types Chart
    const announcementTypesCtx = document.getElementById('announcementTypesChart');
    if (announcementTypesCtx) {
        new Chart(announcementTypesCtx, {
            type: 'doughnut',
            data: {
                labels: ['General', 'Academic', 'Events', 'Urgent', 'Maintenance'],
                datasets: [{
                    data: [35, 25, 20, 15, 5],
                    backgroundColor: [
                        '#3498db',
                        '#2ecc71',
                        '#9b59b6',
                        '#e74c3c',
                        '#f39c12'
                    ],
                    borderWidth: 2,
                    borderColor: '#fff'
                }]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                plugins: {
                    legend: {
                        position: 'bottom'
                    }
                },
                cutout: '60%'
            }
        });
    }
}

function showToast(message, type = 'info') {
    // Create toast element
    const toast = document.createElement('div');
    toast.className = `toast align-items-center text-bg-${type} border-0`;
    toast.setAttribute('role', 'alert');
    toast.setAttribute('aria-live', 'assertive');
    toast.setAttribute('aria-atomic', 'true');
    
    toast.innerHTML = `
        <div class="d-flex">
            <div class="toast-body">
                ${message}
            </div>
            <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
        </div>
    `;
    
    // Add to container
    const container = document.getElementById('toastContainer') || createToastContainer();
    container.appendChild(toast);
    
    // Initialize and show
    const bsToast = new bootstrap.Toast(toast);
    bsToast.show();
    
    // Remove after hide
    toast.addEventListener('hidden.bs.toast', () => {
        toast.remove();
    });
}

function createToastContainer() {
    const container = document.createElement('div');
    container.id = 'toastContainer';
    container.className = 'toast-container position-fixed top-0 end-0 p-3';
    container.style.zIndex = '9999';
    document.body.appendChild(container);
    return container;
}

// Add spinning animation
const style = document.createElement('style');
style.textContent = `
    .spin {
        animation: spin 1s linear infinite;
    }
    @keyframes spin {
        from { transform: rotate(0deg); }
        to { transform: rotate(360deg); }
    }
`;
document.head.appendChild(style);
</script>
{% endblock %}
