{% extends "base/base.html" %}

{% block title %}Notification Preferences{% endblock %}

{% block content %}
<div class="preferences-container" style="max-width: 1000px; margin: 0 auto; padding: 20px;">
    <!-- Header Section -->
    <div class="preferences-header" style="margin-bottom: 32px; text-align: center;">
        <h1 style="font-size: 32px; font-weight: 700; color: #1f2937; margin: 0 0 8px 0;">Notification Preferences</h1>
        <p style="color: #6b7280; margin: 0; font-size: 16px;">Manage how you receive and interact with notifications</p>
    </div>

    <!-- Quick Stats -->
    <div class="stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px; margin-bottom: 32px;">
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #3b82f6;">{{ unread_notification_count }}</div>
            <div style="color: #6b7280; font-size: 14px;">Unread Notifications</div>
        </div>
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #10b981;">{{ total_notifications }}</div>
            <div style="color: #6b7280; font-size: 14px;">Total This Month</div>
        </div>
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #f59e0b;">{{ notification_types.INFO }}</div>
            <div style="color: #6b7280; font-size: 14px;">Info Notifications</div>
        </div>
        <div class="stat-card" style="background: white; padding: 20px; border-radius: 8px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); text-align: center;">
            <div style="font-size: 24px; font-weight: 700; color: #ef4444;">{{ notification_types.URGENT }}</div>
            <div style="color: #6b7280; font-size: 14px;">Urgent Notifications</div>
        </div>
    </div>

    <!-- Preferences Sections -->
    <div class="preferences-sections">
        <!-- Notification Channels -->
        <div class="preference-section" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 24px; overflow: hidden;">
            <div class="section-header" style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; background: #f8fafc;">
                <h2 style="font-size: 20px; font-weight: 600; margin: 0; color: #1f2937;">Delivery Channels</h2>
                <p style="margin: 4px 0 0 0; color: #6b7280; font-size: 14px;">Choose how you want to receive notifications</p>
            </div>
            <div class="section-content" style="padding: 24px;">
                <div class="channel-preferences">
                    <!-- In-App Notifications -->
                    <div class="channel-item" style="display: flex; justify-content: between; align-items: center; padding: 16px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="display: flex; align-items: center; gap: 16px; flex-grow: 1;">
                            <div class="channel-icon" style="width: 40px; height: 40px; background: #3b82f6; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                                ðŸ“±
                            </div>
                            <div>
                                <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 4px 0; color: #1f2937;">In-App Notifications</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 14px;">Notifications within the application</p>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="inAppNotifications" checked style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 52px; height: 28px; background: #3b82f6; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 20px; width: 20px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <!-- Email Notifications -->
                    <div class="channel-item" style="display: flex; justify-content: between; align-items: center; padding: 16px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="display: flex; align-items: center; gap: 16px; flex-grow: 1;">
                            <div class="channel-icon" style="width: 40px; height: 40px; background: #10b981; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                                ðŸ“§
                            </div>
                            <div>
                                <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 4px 0; color: #1f2937;">Email Notifications</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 14px;">Send notifications to your email address</p>
                                <div style="margin-top: 8px;">
                                    <select id="emailFrequency" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                                        <option value="instant">Instant</option>
                                        <option value="digest">Daily Digest</option>
                                        <option value="weekly">Weekly Summary</option>
                                    </select>
                                </div>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="emailNotifications" checked style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 52px; height: 28px; background: #10b981; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 20px; width: 20px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <!-- Browser Push -->
                    <div class="channel-item" style="display: flex; justify-content: between; align-items: center; padding: 16px 0;">
                        <div style="display: flex; align-items: center; gap: 16px; flex-grow: 1;">
                            <div class="channel-icon" style="width: 40px; height: 40px; background: #f59e0b; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 600;">
                                ðŸ””
                            </div>
                            <div>
                                <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 4px 0; color: #1f2937;">Browser Push Notifications</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 14px;">Desktop notifications from your browser</p>
                                <div style="margin-top: 8px;">
                                    <button id="testPushBtn" style="background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer;">
                                        Test Push Notification
                                    </button>
                                </div>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="pushNotifications" style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 52px; height: 28px; background: #d1d5db; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 20px; width: 20px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Notification Types -->
        <div class="preference-section" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 24px; overflow: hidden;">
            <div class="section-header" style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; background: #f8fafc;">
                <h2 style="font-size: 20px; font-weight: 600; margin: 0; color: #1f2937;">Notification Types</h2>
                <p style="margin: 4px 0 0 0; color: #6b7280; font-size: 14px;">Customize which types of notifications you receive</p>
            </div>
            <div class="section-content" style="padding: 24px;">
                <div class="type-preferences">
                    <!-- Info Notifications -->
                    <div class="type-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="display: flex; align-items: center; gap: 12px; flex-grow: 1;">
                            <div class="type-badge" style="background: #dbeafe; color: #1e40af; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                INFO
                            </div>
                            <div>
                                <h3 style="font-size: 14px; font-weight: 600; margin: 0; color: #1f2937;">Information Notifications</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 13px;">General updates and system information</p>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="infoNotifications" checked style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 44px; height: 24px; background: #3b82f6; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 16px; width: 16px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <!-- Success Notifications -->
                    <div class="type-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="display: flex; align-items: center; gap: 12px; flex-grow: 1;">
                            <div class="type-badge" style="background: #d1fae5; color: #065f46; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                SUCCESS
                            </div>
                            <div>
                                <h3 style="font-size: 14px; font-weight: 600; margin: 0; color: #1f2937;">Success Notifications</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 13px;">Completed actions and successful operations</p>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="successNotifications" checked style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 44px; height: 24px; background: #10b981; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 16px; width: 16px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <!-- Warning Notifications -->
                    <div class="type-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="display: flex; align-items: center; gap: 12px; flex-grow: 1;">
                            <div class="type-badge" style="background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                WARNING
                            </div>
                            <div>
                                <h3 style="font-size: 14px; font-weight: 600; margin: 0; color: #1f2937;">Warning Notifications</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 13px;">Important alerts that require attention</p>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="warningNotifications" checked style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 44px; height: 24px; background: #f59e0b; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 16px; width: 16px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <!-- Error Notifications -->
                    <div class="type-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="display: flex; align-items: center; gap: 12px; flex-grow: 1;">
                            <div class="type-badge" style="background: #fee2e2; color: #991b1b; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                ERROR
                            </div>
                            <div>
                                <h3 style="font-size: 14px; font-weight: 600; margin: 0; color: #1f2937;">Error Notifications</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 13px;">System errors and failed operations</p>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="errorNotifications" checked style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 44px; height: 24px; background: #ef4444; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 16px; width: 16px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>

                    <!-- Alert Notifications -->
                    <div class="type-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0;">
                        <div style="display: flex; align-items: center; gap: 12px; flex-grow: 1;">
                            <div class="type-badge" style="background: #fef3c7; color: #92400e; padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: 600;">
                                ALERT
                            </div>
                            <div>
                                <h3 style="font-size: 14px; font-weight: 600; margin: 0; color: #1f2937;">Alert Notifications</h3>
                                <p style="margin: 0; color: #6b7280; font-size: 13px;">Critical alerts requiring immediate action</p>
                            </div>
                        </div>
                        <label class="toggle-switch">
                            <input type="checkbox" id="alertNotifications" checked style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 44px; height: 24px; background: #f59e0b; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 16px; width: 16px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <!-- Priority Settings -->
        <div class="preference-section" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 24px; overflow: hidden;">
            <div class="section-header" style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; background: #f8fafc;">
                <h2 style="font-size: 20px; font-weight: 600; margin: 0; color: #1f2937;">Priority Settings</h2>
                <p style="margin: 4px 0 0 0; color: #6b7280; font-size: 14px;">Configure how different priority levels are handled</p>
            </div>
            <div class="section-content" style="padding: 24px;">
                <div class="priority-settings">
                    <div class="priority-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="flex-grow: 1;">
                            <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0; color: #1f2937;">Low Priority</h3>
                            <p style="margin: 0; color: #6b7280; font-size: 13px;">General information and non-urgent updates</p>
                        </div>
                        <select class="priority-action" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            <option value="normal">Normal Delivery</option>
                            <option value="quiet">Quiet Delivery</option>
                            <option value="digest">Include in Digest</option>
                        </select>
                    </div>

                    <div class="priority-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="flex-grow: 1;">
                            <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0; color: #1f2937;">Medium Priority</h3>
                            <p style="margin: 0; color: #6b7280; font-size: 13px;">Important updates that require attention</p>
                        </div>
                        <select class="priority-action" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            <option value="normal" selected>Normal Delivery</option>
                            <option value="prompt">Prompt Delivery</option>
                            <option value="highlight">Highlight in App</option>
                        </select>
                    </div>

                    <div class="priority-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0; border-bottom: 1px solid #f3f4f6;">
                        <div style="flex-grow: 1;">
                            <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0; color: #1f2937;">High Priority</h3>
                            <p style="margin: 0; color: #6b7280; font-size: 13px;">Time-sensitive alerts and important announcements</p>
                        </div>
                        <select class="priority-action" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            <option value="prompt">Prompt Delivery</option>
                            <option value="highlight" selected>Highlight in App</option>
                            <option value="urgent">Urgent Delivery</option>
                        </select>
                    </div>

                    <div class="priority-item" style="display: flex; justify-content: between; align-items: center; padding: 12px 0;">
                        <div style="flex-grow: 1;">
                            <h3 style="font-size: 14px; font-weight: 600; margin: 0 0 4px 0; color: #1f2937;">Urgent Priority</h3>
                            <p style="margin: 0; color: #6b7280; font-size: 13px;">Critical alerts requiring immediate action</p>
                        </div>
                        <select class="priority-action" style="padding: 6px 12px; border: 1px solid #d1d5db; border-radius: 4px; font-size: 14px;">
                            <option value="urgent" selected>Urgent Delivery</option>
                            <option value="all-channels">All Channels Immediately</option>
                            <option value="override">Override Quiet Hours</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quiet Hours -->
        <div class="preference-section" style="background: white; border-radius: 12px; box-shadow: 0 1px 3px rgba(0,0,0,0.1); margin-bottom: 24px; overflow: hidden;">
            <div class="section-header" style="padding: 20px 24px; border-bottom: 1px solid #e5e7eb; background: #f8fafc;">
                <h2 style="font-size: 20px; font-weight: 600; margin: 0; color: #1f2937;">Quiet Hours</h2>
                <p style="margin: 4px 0 0 0; color: #6b7280; font-size: 14px;">Set times when you don't want to be disturbed</p>
            </div>
            <div class="section-content" style="padding: 24px;">
                <div class="quiet-hours-settings">
                    <div style="display: flex; align-items: center; gap: 16px; margin-bottom: 20px;">
                        <label class="toggle-switch">
                            <input type="checkbox" id="enableQuietHours" style="display: none;">
                            <span class="slider" style="position: relative; display: inline-block; width: 52px; height: 28px; background: #d1d5db; border-radius: 34px; transition: .4s; cursor: pointer;">
                                <span class="slider-circle" style="position: absolute; content: ''; height: 20px; width: 20px; left: 4px; bottom: 4px; background: white; border-radius: 50%; transition: .4s;"></span>
                            </span>
                        </label>
                        <div>
                            <h3 style="font-size: 16px; font-weight: 600; margin: 0 0 4px 0; color: #1f2937;">Enable Quiet Hours</h3>
                            <p style="margin: 0; color: #6b7280; font-size: 14px;">Pause non-urgent notifications during specified times</p>
                        </div>
                    </div>

                    <div id="quietHoursConfig" style="display: none; padding: 20px; background: #f8fafc; border-radius: 8px;">
                        <div style="display: grid; grid-template-columns: 1fr auto 1fr; gap: 16px; align-items: end; margin-bottom: 20px;">
                            <div>
                                <label style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #374151;">Start Time</label>
                                <input type="time" value="22:00" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                            </div>
                            <div style="text-align: center; padding-bottom: 10px; color: #6b7280;">to</div>
                            <div>
                                <label style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 8px; color: #374151;">End Time</label>
                                <input type="time" value="07:00" style="width: 100%; padding: 10px 12px; border: 1px solid #d1d5db; border-radius: 6px;">
                            </div>
                        </div>

                        <div style="margin-bottom: 20px;">
                            <label style="display: block; font-size: 14px; font-weight: 500; margin-bottom: 12px; color: #374151;">Apply to</label>
                            <div style="display: flex; gap: 12px;">
                                <label style="display: flex; align-items: center; gap: 6px;">
                                    <input type="checkbox" checked> Weekdays
                                </label>
                                <label style="display: flex; align-items: center; gap: 6px;">
                                    <input type="checkbox"> Weekends
                                </label>
                                <label style="display: flex; align-items: center; gap: 6px;">
                                    <input type="checkbox"> Everyday
                                </label>
                            </div>
                        </div>

                        <div style="padding: 16px; background: #fef3c7; border-radius: 6px;">
                            <label style="display: flex; align-items: center; gap: 8px; font-size: 14px;">
                                <input type="checkbox" checked>
                                <strong>Allow urgent notifications during quiet hours</strong>
                            </label>
                            <p style="margin: 8px 0 0 0; color: #92400e; font-size: 13px;">
                                Critical and high-priority alerts will still be delivered
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Action Buttons -->
    <div class="action-buttons" style="display: flex; justify-content: flex-end; gap: 12px; margin-top: 32px; padding-top: 24px; border-top: 1px solid #e5e7eb;">
        <button id="resetBtn" style="background: #f3f4f6; color: #374151; border: 1px solid #d1d5db; padding: 12px 24px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s;">
            Reset to Defaults
        </button>
        <button id="saveBtn" style="background: #3b82f6; color: white; border: none; padding: 12px 32px; border-radius: 6px; font-weight: 500; cursor: pointer; transition: all 0.2s;">
            Save Preferences
        </button>
    </div>
</div>

<style>
    /* Toggle switch active state */
    .toggle-switch input:checked + .slider {
        background: #3b82f6 !important;
    }
    
    .toggle-switch input:checked + .slider .slider-circle {
        transform: translateX(24px) !important;
    }
    
    /* Hover effects */
    .toggle-switch:hover .slider {
        opacity: 0.8;
    }
    
    .channel-item:hover, .type-item:hover, .priority-item:hover {
        background: #f8fafc;
        margin-left: -8px;
        margin-right: -8px;
        padding-left: 8px !important;
        padding-right: 8px !important;
        border-radius: 6px;
    }
    
    #saveBtn:hover {
        background: #2563eb !important;
        transform: translateY(-1px);
    }
    
    #resetBtn:hover {
        background: #e5e7eb !important;
    }
    
    .stat-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 6px rgba(0,0,0,0.1) !important;
    }
    
    /* Responsive adjustments */
    @media (max-width: 768px) {
        .stats-grid {
            grid-template-columns: repeat(2, 1fr) !important;
        }
        
        .channel-item, .type-item, .priority-item {
            flex-direction: column !important;
            align-items: flex-start !important;
            gap: 12px !important;
        }
        
        .action-buttons {
            flex-direction: column;
        }
    }
    
    @media (max-width: 640px) {
        .stats-grid {
            grid-template-columns: 1fr !important;
        }
        
        .quiet-hours-config > div {
            grid-template-columns: 1fr !important;
        }
    }
</style>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Toggle switch functionality
        document.querySelectorAll('.toggle-switch input').forEach(checkbox => {
            const slider = checkbox.nextElementSibling;
            
            // Set initial state based on checkbox
            if (checkbox.checked) {
                slider.style.background = getComputedStyle(slider).getPropertyValue('--active-color') || '#3b82f6';
                slider.querySelector('.slider-circle').style.transform = 'translateX(24px)';
            }
            
            slider.addEventListener('click', function() {
                checkbox.checked = !checkbox.checked;
                
                if (checkbox.checked) {
                    this.style.background = '#3b82f6';
                    this.querySelector('.slider-circle').style.transform = 'translateX(24px)';
                } else {
                    this.style.background = '#d1d5db';
                    this.querySelector('.slider-circle').style.transform = 'translateX(4px)';
                }
                
                // Special handling for quiet hours toggle
                if (checkbox.id === 'enableQuietHours') {
                    const config = document.getElementById('quietHoursConfig');
                    if (checkbox.checked) {
                        config.style.display = 'block';
                    } else {
                        config.style.display = 'none';
                    }
                }
            });
        });
        
        // Test push notification
        const testPushBtn = document.getElementById('testPushBtn');
        if (testPushBtn) {
            testPushBtn.addEventListener('click', function() {
                if ('Notification' in window) {
                    if (Notification.permission === 'granted') {
                        new Notification('Test Notification', {
                            body: 'This is a test push notification from your preferences',
                            icon: '/static/images/logo.png'
                        });
                        showToast('Test notification sent!', 'success');
                    } else if (Notification.permission === 'default') {
                        Notification.requestPermission().then(permission => {
                            if (permission === 'granted') {
                                new Notification('Test Notification', {
                                    body: 'This is a test push notification from your preferences',
                                    icon: '/static/images/logo.png'
                                });
                                showToast('Test notification sent!', 'success');
                            }
                        });
                    } else {
                        showToast('Please enable notifications in your browser settings', 'warning');
                    }
                } else {
                    showToast('Push notifications are not supported in your browser', 'warning');
                }
            });
        }
        
        // Save preferences
        const saveBtn = document.getElementById('saveBtn');
        if (saveBtn) {
            saveBtn.addEventListener('click', function() {
                // Show loading state
                saveBtn.innerHTML = 'Saving...';
                saveBtn.disabled = true;
                
                // Collect all preferences
                const preferences = {
                    channels: {
                        inApp: document.getElementById('inAppNotifications').checked,
                        email: document.getElementById('emailNotifications').checked,
                        emailFrequency: document.getElementById('emailFrequency').value,
                        push: document.getElementById('pushNotifications').checked
                    },
                    types: {
                        info: document.getElementById('infoNotifications').checked,
                        success: document.getElementById('successNotifications').checked,
                        warning: document.getElementById('warningNotifications').checked,
                        error: document.getElementById('errorNotifications').checked,
                        alert: document.getElementById('alertNotifications').checked
                    },
                    priorities: {
                        low: document.querySelectorAll('.priority-action')[0].value,
                        medium: document.querySelectorAll('.priority-action')[1].value,
                        high: document.querySelectorAll('.priority-action')[2].value,
                        urgent: document.querySelectorAll('.priority-action')[3].value
                    },
                    quietHours: {
                        enabled: document.getElementById('enableQuietHours').checked,
                        start: document.querySelector('#quietHoursConfig input[type="time"]:first-child').value,
                        end: document.querySelector('#quietHoursConfig input[type="time"]:last-child').value,
                        allowUrgent: document.querySelector('#quietHoursConfig input[type="checkbox"]').checked
                    }
                };
                
                // Simulate API call to save preferences
                fetch('{% url "communication:notification_preferences" %}', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'X-CSRFToken': getCookie('csrftoken'),
                        'X-Requested-With': 'XMLHttpRequest'
                    },
                    body: JSON.stringify(preferences)
                })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        showToast('Preferences saved successfully!', 'success');
                    } else {
                        showToast('Failed to save preferences', 'error');
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    showToast('An error occurred while saving', 'error');
                })
                .finally(() => {
                    saveBtn.innerHTML = 'Save Preferences';
                    saveBtn.disabled = false;
                });
            });
        }
        
        // Reset to defaults
        const resetBtn = document.getElementById('resetBtn');
        if (resetBtn) {
            resetBtn.addEventListener('click', function() {
                if (confirm('Are you sure you want to reset all preferences to default values?')) {
                    // Reset all toggles to default state
                    document.querySelectorAll('.toggle-switch input').forEach(checkbox => {
                        checkbox.checked = true; // Default to enabled
                        const slider = checkbox.nextElementSibling;
                        slider.style.background = '#3b82f6';
                        slider.querySelector('.slider-circle').style.transform = 'translateX(24px)';
                    });
                    
                    // Reset email frequency
                    document.getElementById('emailFrequency').value = 'instant';
                    
                    // Reset priority actions
                    document.querySelectorAll('.priority-action').forEach((select, index) => {
                        const defaults = ['normal', 'normal', 'highlight', 'urgent'];
                        select.value = defaults[index];
                    });
                    
                    // Reset quiet hours
                    document.getElementById('enableQuietHours').checked = false;
                    document.getElementById('quietHoursConfig').style.display = 'none';
                    
                    showToast('Preferences reset to defaults', 'info');
                }
            });
        }
        
        // Utility function to get CSRF token
        function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        
        // Toast notification function
        function showToast(message, type = 'info') {
            // Remove existing toasts
            const existingToasts = document.querySelectorAll('.toast-notification');
            existingToasts.forEach(toast => toast.remove());
            
            // Create toast element
            const toast = document.createElement('div');
            toast.className = `toast-notification toast-${type}`;
            toast.innerHTML = message;
            
            // Style the toast
            Object.assign(toast.style, {
                position: 'fixed',
                top: '20px',
                right: '20px',
                padding: '12px 20px',
                borderRadius: '6px',
                color: 'white',
                fontWeight: '500',
                zIndex: '1000',
                boxShadow: '0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)',
                transition: 'all 0.3s ease',
                transform: 'translateX(100%)',
                opacity: '0'
            });
            
            // Set background color based on type
            const bgColors = {
                'success': '#10b981',
                'error': '#ef4444',
                'info': '#3b82f6',
                'warning': '#f59e0b'
            };
            toast.style.backgroundColor = bgColors[type] || bgColors.info;
            
            // Add to page
            document.body.appendChild(toast);
            
            // Animate in
            setTimeout(() => {
                toast.style.transform = 'translateX(0)';
                toast.style.opacity = '1';
            }, 10);
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.transform = 'translateX(100%)';
                toast.style.opacity = '0';
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
        }
    });
</script>
{% endblock %}
