{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Committee Dashboard" %} - Academic Planning{% endblock %}

{% block content %}
<div class="committee-dashboard">
    <!-- Header Section -->
    <div class="dashboard-header bg-gradient-primary text-white p-4 mb-4 rounded">
        <div class="row align-items-center">
            <div class="col-md-8">
                <h1 class="h3 mb-1">
                    <i class="fas fa-users-cog mr-2"></i>
                    {% trans "Academic Planning Committee Dashboard" %}
                </h1>
                <p class="mb-0 opacity-75">
                    {% trans "Academic Session" %}: {{ current_session.name|default:"No Active Session" }} |
                    {% trans "Committee Overview" %}
                </p>
            </div>
            <div class="col-md-4 text-right">
                <div class="committee-count">
                    <small class="opacity-75">{% trans "Active Committees" %}</small>
                    <div class="h5 mb-0">{{ committees|length }}</div>
                </div>
            </div>
        </div>
    </div>

    <!-- Committee Statistics Cards -->
    <div class="row mb-4">
        <!-- Total Committees -->
        <div class="col-md-3 mb-3">
            <div class="card h-100 border-left-primary">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                {% trans "Active Committees" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                {{ committee_stats.total_committees }}
                            </div>
                            <div class="text-xs text-muted">
                                {% trans "Currently active" %}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-users-cog fa-2x text-primary"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Total Meetings -->
        <div class="col-md-3 mb-3">
            <div class="card h-100 border-left-success">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                {% trans "Total Meetings" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                {{ committee_stats.total_meetings }}
                            </div>
                            <div class="text-xs text-muted">
                                {% trans "This session" %}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar-check fa-2x text-success"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Completed Meetings -->
        <div class="col-md-3 mb-3">
            <div class="card h-100 border-left-info">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-info text-uppercase mb-1">
                                {% trans "Completed Meetings" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                {{ committee_stats.completed_meetings }}
                            </div>
                            <div class="text-xs text-muted">
                                {{ committee_stats.completion_rate|floatformat:1 }}% {% trans "completion rate" %}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-check-circle fa-2x text-info"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Upcoming Meetings -->
        <div class="col-md-3 mb-3">
            <div class="card h-100 border-left-warning">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                {% trans "Upcoming Meetings" %}
                            </div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                {{ upcoming_meetings|length }}
                            </div>
                            <div class="text-xs text-muted">
                                {% trans "Scheduled ahead" %}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clock fa-2x text-warning"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Main Content Grid -->
    <div class="row">
        <!-- My Committees -->
        <div class="col-lg-8 mb-4">
            <div class="card">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-users-cog mr-2"></i>
                        {% trans "My Committees" %}
                    </h6>
                </div>
                <div class="card-body">
                    {% if committees %}
                        <div class="committees-container">
                            {% for committee in committees %}
                            <div class="committee-item mb-3 p-3 border-left-primary bg-light">
                                <div class="row align-items-center">
                                    <div class="col-md-6">
                                        <div class="committee-info">
                                            <h6 class="mb-1">{{ committee.committee_name }}</h6>
                                            <p class="text-muted small mb-1">{{ committee.get_committee_type_display }}</p>
                                            <small class="text-muted">
                                                <i class="fas fa-user-tie mr-1"></i>
                                                {% if committee.chairperson %}
                                                    {{ committee.chairperson.user.get_full_name }}
                                                {% else %}
                                                    {% trans "No Chairperson" %}
                                                {% endif %}
                                            </small>
                                        </div>
                                    </div>
                                    <div class="col-md-3">
                                        <div class="committee-stats">
                                            <div class="stat-item">
                                                <strong>{{ committee.member_count }}</strong>
                                                <small class="text-muted d-block">{% trans "Members" %}</small>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="col-md-3 text-right">
                                        <span class="badge badge-{% if committee.is_term_active %}success{% else %}warning{% endif %}">
                                            {% if committee.is_term_active %}
                                                <i class="fas fa-circle mr-1"></i>{% trans "Active" %}
                                            {% else %}
                                                <i class="fas fa-pause-circle mr-1"></i>{% trans "Inactive" %}
                                            {% endif %}
                                        </span>
                                        {% if committee.department %}
                                        <br>
                                        <small class="text-muted">{{ committee.department.name }}</small>
                                        {% endif %}
                                    </div>
                                </div>
                            </div>
                            {% endfor %}
                        </div>
                    {% else %}
                        <div class="text-center py-4">
                            <i class="fas fa-users-cog fa-3x text-muted mb-3"></i>
                            <h5 class="text-muted">{% trans "No active committee memberships" %}</h5>
                            <p class="text-muted">{% trans "You are not currently a member of any active committees" %}</p>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>

        <!-- Sidebar -->
        <div class="col-lg-4">
            <!-- Upcoming Meetings -->
            {% if upcoming_meetings %}
            <div class="card mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-warning">
                        <i class="fas fa-calendar-alt mr-2"></i>
                        {% trans "Upcoming Meetings" %} ({{ upcoming_meetings|length }})
                    </h6>
                </div>
                <div class="card-body">
                    {% for meeting in upcoming_meetings %}
                    <div class="meeting-item mb-3 pb-3 border-bottom">
                        <h6 class="mb-1">
                            <a href="#" class="text-decoration-none" data-toggle="modal" data-target="#meetingModal{{ meeting.id }}">
                                {{ meeting.committee.committee_name }}
                            </a>
                        </h6>
                        <p class="text-muted small mb-1">{{ meeting.agenda|truncatechars:60|default:"No agenda set" }}</p>
                        <small class="text-primary">
                            <i class="fas fa-calendar mr-1"></i>{{ meeting.meeting_date|date:"M j, Y" }}
                        </small>
                        <br>
                        <small class="text-muted">
                            <i class="fas fa-clock mr-1"></i>{{ meeting.start_time|time:"g:i A" }}
                        </small>
                        <span class="badge badge-{{ meeting.get_meeting_status_display|lower }}" float-right">
                            {{ meeting.get_meeting_status_display }}
                        </span>
                    </div>

                    <!-- Meeting Modal -->
                    <div class="modal fade" id="meetingModal{{ meeting.id }}" tabindex="-1">
                        <div class="modal-dialog modal-lg">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">{{ meeting.committee.committee_name }} - {{ meeting.meeting_date|date:"M j, Y" }}</h5>
                                    <button type="button" class="close" data-dismiss="modal">
                                        <span>&times;</span>
                                    </button>
                                </div>
                                <div class="modal-body">
                                    <p><strong>{% trans "Date & Time" %}:</strong> {{ meeting.meeting_date|date:"l, F j, Y" }} at {{ meeting.start_time|time:"g:i A" }}</p>
                                    <p><strong>{% trans "Location" %}:</strong> {{ meeting.location|default:"TBD" }}</p>
                                    <p><strong>{% trans "Type" %}:</strong> {{ meeting.get_meeting_type_display }}</p>
                                    <p><strong>{% trans "Status" %}:</strong> {{ meeting.get_meeting_status_display }}</p>
                                    {% if meeting.agenda %}
                                    <p><strong>{% trans "Agenda" %}:</strong></p>
                                    <p>{{ meeting.agenda }}</p>
                                    {% endif %}
                                    {% if meeting.meeting_objectives %}
                                    <p><strong>{% trans "Objectives" %}:</strong></p>
                                    <p>{{ meeting.meeting_objectives }}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                    <div class="text-center">
                        <a href="{% url 'academics:committee_meetings' %}" class="btn btn-sm btn-outline-primary">
                            {% trans "View All Meetings" %}
                        </a>
                    </div>
                </div>
            </div>
            {% endif %}

            <!-- Recent Meetings -->
            {% if recent_meetings %}
            <div class="card mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-success">
                        <i class="fas fa-history mr-2"></i>
                        {% trans "Recent Meetings" %} ({{ recent_meetings|length }})
                    </h6>
                </div>
                <div class="card-body">
                    {% for meeting in recent_meetings %}
                    <div class="meeting-item mb-3 pb-3 border-bottom">
                        <h6 class="mb-1">{{ meeting.committee.committee_name }}</h6>
                        <p class="text-muted small mb-1">{{ meeting.agenda|truncatechars:60|default:"No agenda set" }}</p>
                        <small class="text-success">
                            <i class="fas fa-calendar-check mr-1"></i>{{ meeting.meeting_date|date:"M j, Y" }}
                        </small>
                        <span class="badge badge-success float-right">
                            <i class="fas fa-check mr-1"></i>{% trans "Completed" %}
                        </span>
                    </div>
                    {% endfor %}
                </div>
            </div>
            {% endif %}

            <!-- Quick Actions -->
            <div class="card">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-bolt mr-2"></i>
                        {% trans "Quick Actions" %}
                    </h6>
                </div>
                <div class="card-body">
                    <div class="d-grid gap-2">
                        <a href="{% url 'academics:committee_meetings' %}" class="btn btn-outline-primary btn-sm">
                            <i class="fas fa-calendar-plus mr-2"></i>{% trans "View Meetings" %}
                        </a>
                        <a href="#" class="btn btn-outline-success btn-sm">
                            <i class="fas fa-file-alt mr-2"></i>{% trans "Meeting Minutes" %}
                        </a>
                        <a href="#" class="btn btn-outline-info btn-sm">
                            <i class="fas fa-tasks mr-2"></i>{% trans "Action Items" %}
                        </a>
                        <a href="#" class="btn btn-outline-warning btn-sm">
                            <i class="fas fa-chart-line mr-2"></i>{% trans "Committee Reports" %}
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Committee Performance Overview -->
    {% if committee_stats.total_committees > 0 %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-chart-bar mr-2"></i>
                        {% trans "Committee Performance Overview" %}
                    </h6>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4">
                            <div class="metric-card text-center p-3 border rounded">
                                <div class="metric-value h3 mb-2 text-primary">
                                    {{ committee_stats.total_committees }}
                                </div>
                                <div class="metric-label text-muted">{% trans "Active Committees" %}</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="metric-card text-center p-3 border rounded">
                                <div class="metric-value h3 mb-2 text-success">
                                    {{ committee_stats.completion_rate|floatformat:1 }}%
                                </div>
                                <div class="metric-label text-muted">{% trans "Meeting Completion Rate" %}</div>
                            </div>
                        </div>
                        <div class="col-md-4">
                            <div class="metric-card text-center p-3 border rounded">
                                <div class="metric-value h3 mb-2 text-info">
                                    {{ upcoming_meetings|length }}
                                </div>
                                <div class="metric-label text-muted">{% trans "Upcoming Meetings" %}</div>
                            </div>
                        </div>
                    </div>

                    <!-- Committee Types Breakdown -->
                    {% if committees %}
                    <div class="row mt-4">
                        <div class="col-12">
                            <h6 class="text-primary mb-3">{% trans "Committee Types" %}</h6>
                            <div class="committee-types">
                                {% for committee in committees %}
                                <div class="committee-type-item d-inline-block mr-3 mb-2">
                                    <span class="badge badge-secondary badge-lg">
                                        {{ committee.get_committee_type_display }}
                                    </span>
                                </div>
                                {% endfor %}
                            </div>
                        </div>
                    </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>
    {% endif %}

    <!-- Committee Details -->
    {% if committees %}
    <div class="row mt-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">
                        <i class="fas fa-info-circle mr-2"></i>
                        {% trans "Committee Details" %}
                    </h6>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-hover">
                            <thead>
                                <tr>
                                    <th>{% trans "Committee Name" %}</th>
                                    <th>{% trans "Type" %}</th>
                                    <th>{% trans "Chairperson" %}</th>
                                    <th>{% trans "Members" %}</th>
                                    <th>{% trans "Term" %}</th>
                                    <th>{% trans "Status" %}</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for committee in committees %}
                                <tr>
                                    <td>
                                        <strong>{{ committee.committee_name }}</strong>
                                        {% if committee.description %}
                                        <br><small class="text-muted">{{ committee.description|truncatechars:50 }}</small>
                                        {% endif %}
                                    </td>
                                    <td>
                                        <span class="badge badge-primary">{{ committee.get_committee_type_display }}</span>
                                    </td>
                                    <td>
                                        {% if committee.chairperson %}
                                            {{ committee.chairperson.user.get_full_name }}
                                        {% else %}
                                            <span class="text-muted">{% trans "Not Assigned" %}</span>
                                        {% endif %}
                                    </td>
                                    <td>{{ committee.member_count }}</td>
                                    <td>
                                        {{ committee.term_start_date|date:"M Y" }} - {{ committee.term_end_date|date:"M Y" }}
                                    </td>
                                    <td>
                                        {% if committee.is_term_active %}
                                            <span class="badge badge-success">
                                                <i class="fas fa-circle mr-1"></i>{% trans "Active" %}
                                            </span>
                                        {% else %}
                                            <span class="badge badge-warning">
                                                <i class="fas fa-pause-circle mr-1"></i>{% trans "Inactive" %}
                                            </span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% endif %}
</div>

<style>
.dashboard-header {
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
}

.committee-item {
    transition: all 0.3s ease;
}

.committee-item:hover {
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.meeting-item:last-child {
    border-bottom: none !important;
    margin-bottom: 0 !important;
}

.metric-card {
    transition: all 0.3s ease;
}

.metric-card:hover {
    box-shadow: 0 2px 10px rgba(0,0,0,0.1);
    transform: translateY(-2px);
}

.committee-types .badge {
    font-size: 0.85em;
    padding: 6px 12px;
}

.stat-item {
    text-align: center;
}

@media (max-width: 768px) {
    .metric-card {
        margin-bottom: 15px;
    }

    .committee-type-item {
        display: block !important;
        margin-right: 0 !important;
        margin-bottom: 8px !important;
    }
}
</style>

<script>
$(document).ready(function() {
    // Auto-refresh meetings every 10 minutes
    setInterval(function() {
        // Could implement AJAX refresh for meetings here
    }, 600000);
});
</script>
{% endblock %}
