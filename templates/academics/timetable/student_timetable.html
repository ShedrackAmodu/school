{% extends 'academics/base/base.html' %}
{% load static i18n academics_filters %}

{% block title %}{% trans "Student Timetable" %}{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/academics/student_timetable.css' %}">
{% endblock %}

{% block page_title %}{% trans "My Timetable" %}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'academics:student_dashboard' %}">{% trans "Dashboard" %}</a></li>
<li class="breadcrumb-item active" aria-current="page">{% trans "Timetable" %}</li>
{% endblock %}

{% block content %}
<div class="card shadow-sm mb-4">
    <div class="card-header">
        <h5 class="mb-0">{% trans "Timetable for" %} {{ student.full_name }}</h5>
    </div>
    <div class="card-body">
        <div class="row mb-3">
            <div class="col-md-6">
                <label for="sessionSelect" class="form-label">{% trans "Academic Session" %}:</label>
                <select id="sessionSelect" class="form-select">
                    {% for session in academic_sessions %}
                        <option value="{{ session.pk }}" {% if session.pk == current_session.pk %}selected{% endif %}>{{ session.name }}</option>
                    {% endfor %}
                </select>
            </div>
            <div class="col-md-6">
                <label for="termSelect" class="form-label">{% trans "Term" %}:</label>
                <select id="termSelect" class="form-select">
                    {% for term in terms %}
                        <option value="{{ term.pk }}" {% if term.pk == current_term.pk %}selected{% endif %}>{{ term.name }}</option>
                    {% endfor %}
                </select>
            </div>
        </div>

        <div class="timetable-grid">
            <div class="timetable-header-row">
                <div class="timetable-cell header-cell">{% trans "Time" %}</div>
                {% for day in days_of_week %}
                    <div class="timetable-cell header-cell">{{ day }}</div>
                {% endfor %}
            </div>
            {% for period in periods %}
                <div class="timetable-row">
                    <div class="timetable-cell time-cell">{{ period.start_time|time:"H:i" }} - {{ period.end_time|time:"H:i" }}</div>
                    {% for day in days_of_week %}
                        {% with day_data=timetable_data|get_item:day %}
                            {% with timetable_entry=day_data|get_item:period.pk %}
                                {% include 'academics/timetable/includes/timetable_period.html' with entry=timetable_entry %}
                            {% endwith %}
                        {% endwith %}
                    {% endfor %}
                </div>
            {% endfor %}
        </div>

        {% if not timetable_data %}
            <p class="text-center mt-4">{% trans "No timetable entries found for the selected session and term." %}</p>
        {% endif %}
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="{% static 'js/academics/student_timetable.js' %}"></script>
<script>
    // Add any specific JS for student timetable here
    // Example: AJAX to load timetable based on session/term selection
</script>
{% endblock %}
