{% extends 'users/dashboard/dashboard.html' %}
{% load i18n %}

{% block content %}
<div class="dashboard-content">
    <h4 class="mb-4">{% trans "Academic Overview" %}</h4>

    {% if user.is_authenticated %}
        {% if user.user_roles.all.0.role.role_type == 'student' %}
            <!-- Student Dashboard Content -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-transparent border-0">
                    <h5 class="card-title mb-0">{% trans "My Student Dashboard" %}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-book fs-1 text-primary mb-2"></i>
                                <h6>{% trans "Current Class" %}</h6>
                                {% if current_class %}
                                    <p class="text-muted small mb-2">{{ current_class.name }}</p>
                                    <a href="{% url 'academics:class_detail' pk=current_class.pk %}" class="btn btn-primary btn-sm">{% trans "View Class" %}</a>
                                {% else %}
                                    <p class="text-muted small mb-2">{% trans "Not enrolled in a class." %}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-journal-check fs-1 text-success mb-2"></i>
                                <h6>{% trans "Recent Grades" %}</h6>
                                {% if recent_grades %}
                                    <ul class="list-unstyled text-muted small mb-2">
                                        {% for grade in recent_grades %}
                                            <li>{{ grade.subject.name }}: {{ grade.overall_grade }}</li>
                                        {% endfor %}
                                    </ul>
                                    <a href="{% url 'academics:student_report' student_id=student.pk %}" class="btn btn-success btn-sm">{% trans "View All Grades" %}</a>
                                {% else %}
                                    <p class="text-muted small mb-2">{% trans "No recent grades." %}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-calendar-week fs-1 text-info mb-2"></i>
                                <h6>{% trans "My Timetable" %}</h6>
                                <p class="text-muted small mb-2">{% trans "View your class schedule" %}</p>
                                <a href="{% url 'academics:student_timetable' %}" class="btn btn-info btn-sm">{% trans "View Timetable" %}</a>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-clipboard-data fs-1 text-warning mb-2"></i>
                                <h6>{% trans "Attendance Stats" %}</h6>
                                {% if attendance_stats %}
                                    <p class="text-muted small mb-2">{% trans "Present" %}: {{ attendance_stats.present }}%, {% trans "Absent" %}: {{ attendance_stats.absent }}%, {% trans "Late" %}: {{ attendance_stats.late }}%</p>
                                {% else %}
                                    <p class="text-muted small mb-2">{% trans "No attendance data." %}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-journal-text fs-1 text-danger mb-2"></i>
                                <h6>{% trans "Upcoming Assignments" %}</h6>
                                {% if upcoming_assignments %}
                                    <ul class="list-unstyled text-muted small mb-2">
                                        {% for assignment in upcoming_assignments %}
                                            <li>{{ assignment.title }} ({{ assignment.publish_date|date:"M d" }})</li>
                                        {% endfor %}
                                    </ul>
                                    <a href="{% url 'assessment:assignment_list' %}" class="btn btn-danger btn-sm">{% trans "View All Assignments" %}</a>
                                {% else %}
                                    <p class="text-muted small mb-2">{% trans "No upcoming assignments." %}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-journal-bookmark-fill fs-1 text-secondary mb-2"></i>
                                <h6>{% trans "Academic Records" %}</h6>
                                <p class="text-muted small mb-2">{% trans "View detailed academic history" %}</p>
                                <a href="{% url 'academics:student_academic_records' %}" class="btn btn-secondary btn-sm">{% trans "View Records" %}</a>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% elif user.user_roles.all.0.role.role_type == 'teacher' %}
            <!-- Teacher Dashboard Content -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-transparent border-0">
                    <h5 class="card-title mb-0">{% trans "My Teacher Dashboard" %}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-person-badge fs-1 text-primary mb-2"></i>
                                <h6>{% trans "My Assignments" %}</h6>
                                {% if current_assignments %}
                                    <ul class="list-unstyled text-muted small mb-2">
                                        {% for assignment in current_assignments %}
                                            <li>{{ assignment.subject.name }} ({{ assignment.class_assigned.name }})</li>
                                        {% endfor %}
                                    </ul>
                                    <a href="{% url 'academics:subject_list' %}" class="btn btn-primary btn-sm">{% trans "View All Assignments" %}</a>
                                {% else %}
                                    <p class="text-muted small mb-2">{% trans "No current assignments." %}</p>
                                {% endif %}
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-people fs-1 text-success mb-2"></i>
                                <h6>{% trans "Total Students" %}</h6>
                                <p class="text-muted small mb-2">{{ total_students }} {% trans "students across my classes" %}</p>
                                <a href="{% url 'academics:student_list' %}" class="btn btn-success btn-sm">{% trans "View Students" %}</a>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-calendar-event fs-1 text-info mb-2"></i>
                                <h6>{% trans "Upcoming Classes" %}</h6>
                                {% if upcoming_classes %}
                                    <ul class="list-unstyled text-muted small mb-2">
                                        {% for class_entry in upcoming_classes %}
                                            <li>{{ class_entry.subject.name }} ({{ class_entry.start_time|time:"H:i" }})</li>
                                        {% endfor %}
                                    </ul>
                                    <a href="{% url 'academics:teacher_timetable' %}" class="btn btn-info btn-sm">{% trans "View Timetable" %}</a>
                                {% else %}
                                    <p class="text-muted small mb-2">{% trans "No upcoming classes today." %}</p>
                                {% endif %}
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-pencil-square fs-1 text-warning mb-2"></i>
                                <h6>{% trans "Pending Grading" %}</h6>
                                <p class="text-muted small mb-2">{{ pending_grading }} {% trans "items to grade" %}</p>
                                <a href="{% url 'assessment:assignment_list' %}" class="btn btn-warning btn-sm">{% trans "Go to Grading" %}</a>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-journal-text fs-1 text-danger mb-2"></i>
                                <h6>{% trans "Class Materials" %}</h6>
                                <p class="text-muted small mb-2">{% trans "Manage teaching materials" %}</p>
                                <a href="{% url 'academics:material_list' %}" class="btn btn-danger btn-sm">{% trans "Manage Materials" %}</a>
                            </div>
                        </div>
                        <div class="col-md-4 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-graph-up fs-1 text-secondary mb-2"></i>
                                <h6>{% trans "Performance" %}</h6>
                                <p class="text-muted small mb-2">{% trans "View class performance" %}</p>
                                <a href="{% url 'academics:class_list' %}" class="btn btn-secondary btn-sm">{% trans "View Classes" %}</a>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="card-title mb-0">{% trans "Quick Actions" %}</h6>
                                </div>
                                <div class="card-body d-flex flex-wrap gap-2">
                                    <a href="{% url 'academics:material_create' %}" class="btn btn-outline-primary btn-sm">
                                        <i class="bi bi-plus-circle me-1"></i> {% trans "Create Class Material" %}
                                    </a>
                                    <a href="#" class="btn btn-outline-success btn-sm">
                                        <i class="bi bi-pencil-fill me-1"></i> {% trans "Enter Grades" %}
                                    </a>
                                    <a href="#" class="btn btn-outline-info btn-sm">
                                        <i class="bi bi-clipboard-check me-1"></i> {% trans "Manage Attendance" %}
                                    </a>
                                    <a href="{% url 'academics:timetable_create' %}" class="btn btn-outline-warning btn-sm">
                                        <i class="bi bi-calendar-plus me-1"></i> {% trans "Add Timetable" %}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% elif user.is_staff %}
            <!-- Staff/Admin Dashboard Content -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-transparent border-0">
                    <h5 class="card-title mb-0">{% trans "Academic Administration Dashboard" %}</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-3 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-person-lines-fill fs-1 text-primary mb-2"></i>
                                <h6>{% trans "Total Students" %}</h6>
                                <p class="text-muted small mb-2">{{ total_students }}</p>
                                <a href="{% url 'academics:student_list' %}" class="btn btn-primary btn-sm">{% trans "View Students" %}</a>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-person-video3 fs-1 text-success mb-2"></i>
                                <h6>{% trans "Total Teachers" %}</h6>
                                <p class="text-muted small mb-2">{{ total_teachers }}</p>
                                <a href="{% url 'academics:teacher_list' %}" class="btn btn-success btn-sm">{% trans "View Teachers" %}</a>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-house-door fs-1 text-info mb-2"></i>
                                <h6>{% trans "Total Classes" %}</h6>
                                <p class="text-muted small mb-2">{{ total_classes }}</p>
                                <a href="{% url 'academics:class_list' %}" class="btn btn-info btn-sm">{% trans "View Classes" %}</a>
                            </div>
                        </div>
                        <div class="col-md-3 mb-3">
                            <div class="text-center p-3 border rounded bg-light">
                                <i class="bi bi-book fs-1 text-warning mb-2"></i>
                                <h6>{% trans "Total Subjects" %}</h6>
                                <p class="text-muted small mb-2">{{ total_subjects }}</p>
                                <a href="{% url 'academics:subject_list' %}" class="btn btn-warning btn-sm">{% trans "View Subjects" %}</a>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-md-6 mb-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="card-title mb-0">{% trans "Recent Enrollments" %}</h6>
                                </div>
                                <div class="card-body">
                                    {% if recent_enrollments %}
                                        <ul class="list-group list-group-flush">
                                            {% for enrollment in recent_enrollments %}
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    {{ enrollment.student.user.full_name }} - {{ enrollment.class_enrolled.name }}
                                                    <span class="badge bg-secondary">{{ enrollment.enrollment_date|date:"M d, Y" }}</span>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                        <div class="text-end mt-3">
                                            <a href="{% url 'academics:enrollment_list' %}" class="btn btn-outline-primary btn-sm">{% trans "View All Enrollments" %}</a>
                                        </div>
                                    {% else %}
                                        <p class="text-muted text-center">{% trans "No recent enrollments." %}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                        <div class="col-md-6 mb-3">
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="card-title mb-0">{% trans "Upcoming Holidays" %}</h6>
                                </div>
                                <div class="card-body">
                                    {% if upcoming_holidays %}
                                        <ul class="list-group list-group-flush">
                                            {% for holiday in upcoming_holidays %}
                                                <li class="list-group-item d-flex justify-content-between align-items-center">
                                                    {{ holiday.name }}
                                                    <span class="badge bg-info">{{ holiday.date|date:"M d, Y" }}</span>
                                                </li>
                                            {% endfor %}
                                        </ul>
                                        <div class="text-end mt-3">
                                            <a href="{% url 'academics:academic_calendar' %}" class="btn btn-outline-primary btn-sm">{% trans "View Calendar" %}</a>
                                        </div>
                                    {% else %}
                                        <p class="text-muted text-center">{% trans "No upcoming holidays." %}</p>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="row mt-3">
                        <div class="col-12">
                            <div class="card border-0 shadow-sm">
                                <div class="card-header bg-transparent border-0">
                                    <h6 class="card-title mb-0">{% trans "Quick Actions" %}</h6>
                                </div>
                                <div class="card-body d-flex flex-wrap gap-2">
                                    <a href="{% url 'academics:session_create' %}" class="btn btn-outline-primary btn-sm">
                                        <i class="bi bi-calendar-plus me-1"></i> {% trans "Add Session" %}
                                    </a>
                                    <a href="{% url 'academics:department_create' %}" class="btn btn-outline-success btn-sm">
                                        <i class="bi bi-building-add me-1"></i> {% trans "Add Department" %}
                                    </a>
                                    <a href="{% url 'academics:subject_create' %}" class="btn btn-outline-info btn-sm">
                                        <i class="bi bi-book-half me-1"></i> {% trans "Add Subject" %}
                                    </a>
                                    <a href="{% url 'academics:class_create' %}" class="btn btn-outline-warning btn-sm">
                                        <i class="bi bi-house-add me-1"></i> {% trans "Add Class" %}
                                    </a>
                                    <a href="{% url 'academics:bulk_enrollment' %}" class="btn btn-outline-danger btn-sm">
                                        <i class="bi bi-person-plus-fill me-1"></i> {% trans "Bulk Enroll" %}
                                    </a>
                                    <a href="{% url 'academics:timetable_list' %}" class="btn btn-outline-secondary btn-sm">
                                        <i class="bi bi-table me-1"></i> {% trans "Manage Timetable" %}
                                    </a>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        {% endif %}
    {% else %}
        <div class="alert alert-warning" role="alert">
            {% trans "Please log in to access the academic dashboard." %}
        </div>
    {% endif %}
</div>
{% endblock %}
