{% extends 'base/base.html' %}
{% load static i18n %}

{% block title %}
    {% if form.instance.pk %}
        {% trans "Edit Teacher" %}
    {% else %}
        {% trans "Create Teacher" %}
    {% endif %}
{% endblock %}

{% block body_class %}academics-teachers-form{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'academics:teacher_list' %}">{% trans "Teachers" %}</a></li>
<li class="breadcrumb-item active" aria-current="page">
    {% if form.instance.pk %}
        {% trans "Edit Teacher" %}
    {% else %}
        {% trans "New Teacher" %}
    {% endif %}
</li>
{% endblock %}

{% block page_actions %}
<div class="page-actions">
    <div class="btn-group" role="group">
        <a href="{% url 'academics:teacher_list' %}" class="btn btn-outline-secondary">
            <i class="bi bi-arrow-left me-2"></i>{% trans "Back to List" %}
        </a>
    </div>
</div>
{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/academics/forms.css' %}">
<style>
    .photo-preview { width: 150px; height: 150px; border-radius: 8px; object-fit: cover; border: 2px dashed var(--bs-border-color); }
    .photo-placeholder { width: 150px; height: 150px; border-radius: 8px; background: var(--bs-light); display: flex; align-items: center; justify-content: center; border: 2px dashed var(--bs-border-color); }
    .photo-upload-area { cursor: pointer; transition: all 0.3s ease; }
    .photo-upload-area:hover { border-color: var(--bs-primary); background: var(--bs-light); }
    .experience-badge { background: linear-gradient(135deg, var(--bs-warning), #ffc107); }
</style>
{% endblock %}

{% block content %}
<div class="teacher-form-container">
    <div class="row justify-content-center">
        <div class="col-lg-10">
            <div class="card form-card">
                <div class="card-header">
                    <h5 class="card-title mb-0">
                        <i class="bi {% if form.instance.pk %}bi-pencil-square{% else %}bi-plus-circle{% endif %} me-2"></i>
                        {% if form.instance.pk %}
                            {% trans "Edit Teacher" %}
                        {% else %}
                            {% trans "Create New Teacher" %}
                        {% endif %}
                    </h5>
                </div>
                <div class="card-body">
                    <form method="post" id="teacherForm" novalidate enctype="multipart/form-data">
                        {% csrf_token %}
                        
                        {% if form.non_field_errors %}
                        <div class="alert alert-danger">
                            {% for error in form.non_field_errors %}
                                <p class="mb-0">{{ error }}</p>
                            {% endfor %}
                        </div>
                        {% endif %}

                        <!-- Teacher Photo -->
                        <div class="field-group">
                            <div class="field-group-header">
                                <h6 class="field-group-title">{% trans "Teacher Photo" %}</h6>
                                <p class="field-group-description mb-0">
                                    {% trans "Upload a professional photo for teacher identification" %}
                                </p>
                            </div>

                            <div class="row align-items-center">
                                <div class="col-md-3 text-center">
                                    <div class="photo-upload-area" id="photoUploadArea">
                                        {% if form.instance.photo %}
                                        <img src="{{ form.instance.photo.url }}" alt="Teacher Photo" class="photo-preview" id="photoPreview">
                                        {% else %}
                                        <div class="photo-placeholder" id="photoPlaceholder">
                                            <div class="text-center">
                                                <i class="bi bi-camera fs-1 text-muted"></i>
                                                <p class="mt-2 mb-0 text-muted">{% trans "Click to upload photo" %}</p>
                                            </div>
                                        </div>
                                        {% endif %}
                                    </div>
                                    <input type="file" name="photo" id="photoInput" accept="image/*" style="display: none;">
                                    <div class="mt-2">
                                        <button type="button" class="btn btn-sm btn-outline-secondary" onclick="document.getElementById('photoInput').click()">
                                            <i class="bi bi-upload me-1"></i>{% trans "Upload" %}
                                        </button>
                                        {% if form.instance.photo %}
                                        <button type="button" class="btn btn-sm btn-outline-danger" id="removePhoto">
                                            <i class="bi bi-trash me-1"></i>{% trans "Remove" %}
                                        </button>
                                        {% endif %}
                                    </div>
                                </div>
                                <div class="col-md-9">
                                    <div class="alert alert-info">
                                        <small>
                                            <i class="bi bi-info-circle me-2"></i>
                                            {% trans "Recommended: Professional headshot, minimum 300x300 pixels. Maximum file size: 2MB." %}
                                        </small>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Basic Information Field Group -->
                        <div class="field-group">
                            <div class="field-group-header">
                                <h6 class="field-group-title">{% trans "Basic Information" %}</h6>
                                <p class="field-group-description mb-0">
                                    {% trans "Enter the teacher's personal and identification details" %}
                                </p>
                            </div>

                            <div class="row">
                                <!-- Teacher ID -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.teacher_id.id_for_label }}" class="form-label required">
                                        {{ form.teacher_id.label }}
                                    </label>
                                    {{ form.teacher_id }}
                                    {% if form.teacher_id.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.teacher_id.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    <div class="form-text">
                                        {% trans "Unique teacher identification number" %}
                                    </div>
                                </div>

                                <!-- Employee ID -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.employee_id.id_for_label }}" class="form-label required">
                                        {{ form.employee_id.label }}
                                    </label>
                                    {{ form.employee_id }}
                                    {% if form.employee_id.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.employee_id.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="row">
                                <!-- First Name -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.user.first_name.id_for_label }}" class="form-label required">
                                        {% trans "First Name" %}
                                    </label>
                                    <input type="text" class="form-control" name="first_name" value="{{ form.user.first_name.value|default:'' }}" required>
                                </div>

                                <!-- Last Name -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.user.last_name.id_for_label }}" class="form-label required">
                                        {% trans "Last Name" %}
                                    </label>
                                    <input type="text" class="form-control" name="last_name" value="{{ form.user.last_name.value|default:'' }}" required>
                                </div>
                            </div>

                            <div class="row">
                                <!-- Date of Birth -->
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.date_of_birth.id_for_label }}" class="form-label">
                                        {{ form.date_of_birth.label }}
                                    </label>
                                    {{ form.date_of_birth }}
                                    {% if form.date_of_birth.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.date_of_birth.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Gender -->
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.gender.id_for_label }}" class="form-label required">
                                        {{ form.gender.label }}
                                    </label>
                                    {{ form.gender }}
                                    {% if form.gender.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.gender.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Joining Date -->
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.joining_date.id_for_label }}" class="form-label required">
                                        {{ form.joining_date.label }}
                                    </label>
                                    {{ form.joining_date }}
                                    {% if form.joining_date.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.joining_date.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Contact Information Field Group -->
                        <div class="field-group">
                            <div class="field-group-header">
                                <h6 class="field-group-title">{% trans "Contact Information" %}</h6>
                                <p class="field-group-description mb-0">
                                    {% trans "Teacher's contact details and address information" %}
                                </p>
                            </div>

                            <div class="row">
                                <!-- Email -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.user.email.id_for_label }}" class="form-label required">
                                        {% trans "Email Address" %}
                                    </label>
                                    <input type="email" class="form-control" name="email" value="{{ form.user.email.value|default:'' }}" required>
                                </div>

                                <!-- Mobile -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.user.mobile.id_for_label }}" class="form-label">
                                        {% trans "Mobile Number" %}
                                    </label>
                                    <input type="tel" class="form-control" name="mobile" value="{{ form.user.mobile.value|default:'' }}">
                                </div>
                            </div>

                            <!-- Address Fields -->
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="{{ form.address_line_1.id_for_label }}" class="form-label">
                                        {{ form.address_line_1.label }}
                                    </label>
                                    {{ form.address_line_1 }}
                                </div>
                            </div>

                            <div class="row">
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.city.id_for_label }}" class="form-label">
                                        {{ form.city.label }}
                                    </label>
                                    {{ form.city }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.state.id_for_label }}" class="form-label">
                                        {{ form.state.label }}
                                    </label>
                                    {{ form.state }}
                                </div>
                                <div class="col-md-4 mb-3">
                                    <label for="{{ form.postal_code.id_for_label }}" class="form-label">
                                        {{ form.postal_code.label }}
                                    </label>
                                    {{ form.postal_code }}
                                </div>
                            </div>
                        </div>

                        <!-- Professional Information Field Group -->
                        <div class="field-group">
                            <div class="field-group-header">
                                <h6 class="field-group-title">{% trans "Professional Information" %}</h6>
                                <p class="field-group-description mb-0">
                                    {% trans "Teacher's qualifications, experience, and department assignment" %}
                                </p>
                            </div>

                            <div class="row">
                                <!-- Department -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.department.id_for_label }}" class="form-label">
                                        {{ form.department.label }}
                                    </label>
                                    {{ form.department }}
                                    {% if form.department.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.department.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="row">
                                <!-- Teacher Type -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.teacher_type.id_for_label }}" class="form-label">
                                        {{ form.teacher_type.label }}
                                    </label>
                                    {{ form.teacher_type }}
                                    {% if form.teacher_type.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.teacher_type.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Experience Years -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.experience_years.id_for_label }}" class="form-label">
                                        {{ form.experience_years.label }}
                                    </label>
                                    {{ form.experience_years }}
                                    {% if form.experience_years.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.experience_years.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <div class="row">
                                <!-- Is Class Teacher -->
                                <div class="col-md-6 mb-3">
                                    <div class="form-check form-switch">
                                        {{ form.is_class_teacher }}
                                        <label class="form-check-label" for="{{ form.is_class_teacher.id_for_label }}">
                                            {{ form.is_class_teacher.label }}
                                        </label>
                                    </div>
                                    {% if form.is_class_teacher.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.is_class_teacher.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    <div class="form-text">
                                        {% trans "Class teachers are assigned to specific classes" %}
                                    </div>
                                </div>

                                <!-- Status -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.status.id_for_label }}" class="form-label">
                                        {{ form.status.label }}
                                    </label>
                                    {{ form.status }}
                                    {% if form.status.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.status.errors %}
                                            {{ error %}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Biography -->
                            <div class="row">
                                <div class="col-12 mb-3">
                                    <label for="{{ form.bio.id_for_label }}" class="form-label">
                                        {{ form.bio.label }}
                                    </label>
                                    {{ form.bio }}
                                    {% if form.bio.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.bio.errors %}
                                            {{ error %}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                    <div class="form-text">
                                        {% trans "Brief biography and teaching experience" %}
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- Qualifications Field Group -->
                        <div class="field-group">
                            <div class="field-group-header">
                                <h6 class="field-group-title">{% trans "Qualifications & Specialization" %}</h6>
                                <p class="field-group-description mb-0">
                                    {% trans "Teacher's educational qualifications and specializations" %}
                                </p>
                            </div>

                            <div class="row">
                                <!-- Qualification -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.qualification.id_for_label }}" class="form-label">
                                        {{ form.qualification.label }}
                                    </label>
                                    {{ form.qualification }}
                                    {% if form.qualification.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.qualification.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Specialization -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.specialization.id_for_label }}" class="form-label">
                                        {{ form.specialization.label }}
                                    </label>
                                    {{ form.specialization }}
                                    {% if form.specialization.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.specialization.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Emergency Contact Field Group -->
                        <div class="field-group">
                            <div class="field-group-header">
                                <h6 class="field-group-title">{% trans "Emergency Contact" %}</h6>
                                <p class="field-group-description mb-0">
                                    {% trans "Emergency contact information for the teacher" %}
                                </p>
                            </div>

                            <div class="row">
                                <!-- Emergency Contact -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.emergency_contact.id_for_label }}" class="form-label">
                                        {{ form.emergency_contact.label }}
                                    </label>
                                    {{ form.emergency_contact }}
                                    {% if form.emergency_contact.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.emergency_contact.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>

                                <!-- Emergency Phone -->
                                <div class="col-md-6 mb-3">
                                    <label for="{{ form.emergency_phone.id_for_label }}" class="form-label">
                                        {{ form.emergency_phone.label }}
                                    </label>
                                    {{ form.emergency_phone }}
                                    {% if form.emergency_phone.errors %}
                                    <div class="invalid-feedback d-block">
                                        {% for error in form.emergency_phone.errors %}
                                            {{ error }}
                                        {% endfor %}
                                    </div>
                                    {% endif %}
                                </div>
                            </div>
                        </div>

                        <!-- Form Actions -->
                        <div class="form-actions border-top pt-4">
                            <div class="d-flex justify-content-between align-items-center">
                                <a href="{% url 'academics:teacher_list' %}" class="btn btn-outline-secondary">
                                    <i class="bi bi-x-circle me-2"></i>{% trans "Cancel" %}
                                </a>
                                <div class="btn-group">
                                    <button type="submit" class="btn btn-primary" id="submitBtn">
                                        <i class="bi {% if form.instance.pk %}bi-check-lg{% else %}bi-plus-lg{% endif %} me-2"></i>
                                        {% if form.instance.pk %}
                                            {% trans "Update Teacher" %}
                                        {% else %}
                                            {% trans "Create Teacher" %}
                                        {% endif %}
                                    </button>
                                    {% if form.instance.pk %}
                                    <button type="button" class="btn btn-primary dropdown-toggle dropdown-toggle-split" data-bs-toggle="dropdown" aria-expanded="false">
                                        <span class="visually-hidden">{% trans "Toggle Dropdown" %}</span>
                                    </button>
                                    <ul class="dropdown-menu">
                                        <li>
                                            <button type="submit" name="save_and_continue" class="dropdown-item">
                                                <i class="bi bi-check2-circle me-2"></i>{% trans "Save and Continue Editing" %}
                                            </button>
                                        </li>
                                        <li>
                                            <button type="submit" name="save_and_add_another" class="dropdown-item">
                                                <i class="bi bi-plus-circle me-2"></i>{% trans "Save and Add Another" %}
                                            </button>
                                        </li>
                                    </ul>
                                    {% endif %}
                                </div>
                            </div>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}
