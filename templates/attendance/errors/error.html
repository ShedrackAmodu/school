<!-- templates/attendance/errors/error.html -->
{% extends 'base/base.html' %}
{% load static %}

{% block title %}Error - Excellence Academy{% endblock %}

{% block extra_css %}
<style>
.error-container {
    min-height: 60vh;
    display: flex;
    align-items: center;
    justify-content: center;
}
.error-card {
    max-width: 500px;
    margin: 0 auto;
    border: none;
    box-shadow: 0 4px 20px rgba(0,0,0,0.1);
}
.error-icon {
    font-size: 4rem;
    margin-bottom: 1rem;
}
.error-actions .btn {
    min-width: 120px;
}
</style>
{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="error-container">
        <div class="card error-card">
            <div class="card-body text-center p-5">
                <!-- Error Icon -->
                <div class="error-icon text-danger">
                    <i class="fas fa-exclamation-triangle"></i>
                </div>
                
                <!-- Error Title -->
                <h2 class="card-title h4 text-danger mb-3">
                    {% if error_code == 500 %}
                    Server Error
                    {% elif error_code == 404 %}
                    Page Not Found
                    {% elif error_code == 403 %}
                    Access Denied
                    {% else %}
                    Something Went Wrong
                    {% endif %}
                </h2>
                
                <!-- Error Message -->
                <div class="card-text text-muted mb-4">
                    {% if error_message %}
                    <p>{{ error_message }}</p>
                    {% else %}
                        {% if error_code == 500 %}
                        <p>We're experiencing some technical difficulties. Please try again later.</p>
                        {% elif error_code == 404 %}
                        <p>The page you're looking for doesn't exist or has been moved.</p>
                        {% elif error_code == 403 %}
                        <p>You don't have permission to access this resource.</p>
                        {% else %}
                        <p>An unexpected error has occurred. Our team has been notified.</p>
                        {% endif %}
                    {% endif %}
                    
                    <p class="small">
                        Error Code: <strong>{{ error_code|default:"Unknown" }}</strong><br>
                        {% if request.sentry_event_id %}
                        Event ID: <strong>{{ request.sentry_event_id }}</strong>
                        {% endif %}
                    </p>
                </div>
                
                <!-- Error Details (for development) -->
                {% if debug and exception %}
                <div class="alert alert-warning text-start small mb-4">
                    <strong>Technical Details:</strong><br>
                    <code>{{ exception }}</code>
                </div>
                {% endif %}
                
                <!-- Action Buttons -->
                <div class="error-actions d-flex gap-2 justify-content-center">
                    <button type="button" class="btn btn-outline-secondary" onclick="window.history.back()">
                        <i class="fas fa-arrow-left me-1"></i> Go Back
                    </button>
                    <a href="{% url 'attendance:dashboard' %}" class="btn btn-primary">
                        <i class="fas fa-home me-1"></i> Dashboard
                    </a>
                    <button type="button" class="btn btn-outline-info" onclick="location.reload()">
                        <i class="fas fa-redo me-1"></i> Try Again
                    </button>
                </div>
                
                <!-- Support Information -->
                <div class="mt-4 pt-3 border-top">
                    <p class="small text-muted mb-2">
                        If the problem persists, please contact support.
                    </p>
                    <div class="d-flex justify-content-center gap-3">
                        <a href="mailto:support@schoolsystem.edu" class="text-decoration-none">
                            <i class="fas fa-envelope me-1"></i> Email Support
                        </a>
                        <a href="tel:+1234567890" class="text-decoration-none">
                            <i class="fas fa-phone me-1"></i> Call Support
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    // Log error details for debugging
    console.error('Attendance System Error:', {
        code: {{ error_code|default:"Unknown" }},
        message: "{{ error_message|default:'No specific message' }}",
        path: window.location.pathname,
        timestamp: new Date().toISOString()
    });
    
    // Auto-refresh for certain error types after delay
    {% if error_code == 500 or error_code == 502 %}
    setTimeout(() => {
        console.log('Attempting auto-refresh...');
        location.reload();
    }, 10000); // Refresh after 10 seconds
    {% endif %}
});
</script>
{% endblock %}