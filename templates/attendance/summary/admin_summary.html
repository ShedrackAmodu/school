<!-- templates/attendance/summary/admin_summary.html -->
<div class="row">
    <!-- School Overview -->
    <div class="col-lg-8 mb-4">
        <div class="card shadow h-100">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">School Attendance Overview</h6>
            </div>
            <div class="card-body">
                <!-- School-wide Chart -->
                <div class="mb-4">
                    <h6 class="border-bottom pb-2">School Attendance Distribution</h6>
                    <div id="schoolOverviewChart" class="chart-container">
                        <!-- Chart will be loaded by JavaScript -->
                    </div>
                </div>

                <!-- Key Metrics -->
                <div class="row">
                    <div class="col-md-3 text-center mb-3">
                        <div class="card border-primary">
                            <div class="card-body">
                                <div class="h4 text-primary mb-0">{{ school_stats.total_students }}</div>
                                <div class="text-muted">Total Students</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="card border-success">
                            <div class="card-body">
                                <div class="h4 text-success mb-0">{{ school_stats.attendance_rate }}%</div>
                                <div class="text-muted">Attendance Rate</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="card border-warning">
                            <div class="card-body">
                                <div class="h4 text-warning mb-0">{{ school_stats.late_arrivals }}</div>
                                <div class="text-muted">Late Today</div>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-3 text-center mb-3">
                        <div class="card border-danger">
                            <div class="card-body">
                                <div class="h4 text-danger mb-0">{{ school_stats.absent_today }}</div>
                                <div class="text-muted">Absent Today</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Class-wise Performance -->
                <div class="mt-4">
                    <h6 class="border-bottom pb-2">Class-wise Performance</h6>
                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                                <tr>
                                    <th>Class</th>
                                    <th>Total Students</th>
                                    <th>Present Today</th>
                                    <th>Absent Today</th>
                                    <th>Attendance %</th>
                                    <th>Trend</th>
                                </tr>
                            </thead>
                            <tbody>
                                {% for class in class_performance %}
                                <tr>
                                    <td>
                                        <strong>{{ class.name }}</strong>
                                        <br>
                                        <small class="text-muted">{{ class.teacher|default:"No teacher" }}</small>
                                    </td>
                                    <td>{{ class.total_students }}</td>
                                    <td class="text-success">{{ class.present_today }}</td>
                                    <td class="text-danger">{{ class.absent_today }}</td>
                                    <td>
                                        <div class="d-flex align-items-center">
                                            <div class="progress flex-grow-1 me-2 progress-thin">
                                                <div class="progress-bar 
                                                    {% if class.attendance_percentage >= 90 %}bg-success
                                                    {% elif class.attendance_percentage >= 75 %}bg-warning
                                                    {% else %}bg-danger{% endif %}" 
                                                     style="width: {{ class.attendance_percentage }}%">
                                                </div>
                                            </div>
                                            <span>{{ class.attendance_percentage }}%</span>
                                        </div>
                                    </td>
                                    <td>
                                        {% if class.trend > 0 %}
                                        <span class="text-success"><i class="fas fa-arrow-up"></i> {{ class.trend }}%</span>
                                        {% elif class.trend < 0 %}
                                        <span class="text-danger"><i class="fas fa-arrow-down"></i> {% widthratio class.trend -1 1 %}%</span>
                                        {% else %}
                                        <span class="text-muted"><i class="fas fa-minus"></i> 0%</span>
                                        {% endif %}
                                    </td>
                                </tr>
                                {% empty %}
                                <tr>
                                    <td colspan="6" class="text-center py-4">
                                        <i class="fas fa-chalkboard-teacher fa-2x text-muted mb-3"></i>
                                        <p class="text-muted">No class data available</p>
                                    </td>
                                </tr>
                                {% endfor %}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Admin Dashboard -->
    <div class="col-lg-4 mb-4">
        <!-- System Status -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">System Status</h6>
            </div>
            <div class="card-body">
                <div class="list-group list-group-flush">
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Attendance Sessions
                        <span class="badge bg-success rounded-pill">{{ system_status.active_sessions }}/{{ system_status.total_sessions }}</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Active Classes
                        <span class="badge bg-primary rounded-pill">{{ system_status.active_classes }}</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Today's Records
                        <span class="badge bg-info rounded-pill">{{ system_status.today_records }}</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        Pending Leaves
                        <span class="badge bg-warning rounded-pill">{{ system_status.pending_leaves }}</span>
                    </div>
                    <div class="list-group-item d-flex justify-content-between align-items-center">
                        System Uptime
                        <span class="badge bg-success rounded-pill">{{ system_status.uptime }}</span>
                    </div>
                </div>
            </div>
        </div>

        <!-- Quick Actions -->
        <div class="card shadow mb-4">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Quick Actions</h6>
            </div>
            <div class="card-body">
                <div class="d-grid gap-2">
                    <a href="{% url 'attendance:config' %}" class="btn btn-outline-primary">
                        <i class="fas fa-cog me-1"></i> System Configuration
                    </a>
                    <a href="{% url 'attendance:session_list' %}" class="btn btn-outline-info">
                        <i class="fas fa-clock me-1"></i> Manage Sessions
                    </a>
                    <a href="{% url 'attendance:leave_list' %}" class="btn btn-outline-warning">
                        <i class="fas fa-calendar-check me-1"></i> Review Leaves
                    </a>
                    <button type="button" class="btn btn-outline-success" onclick="runAttendanceAudit()">
                        <i class="fas fa-search me-1"></i> Run Audit
                    </button>
                </div>
            </div>
        </div>

        <!-- Recent Alerts -->
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">System Alerts</h6>
            </div>
            <div class="card-body">
                {% if system_alerts %}
                <div class="list-group list-group-flush">
                    {% for alert in system_alerts %}
                    <div class="list-group-item">
                        <div class="d-flex w-100 justify-content-between">
                            <h6 class="mb-1 text-{{ alert.type }}">
                                <i class="fas fa-{{ alert.icon }} me-2"></i>
                                {{ alert.title }}
                            </h6>
                            <small class="text-muted">{{ alert.time }}</small>
                        </div>
                        <p class="mb-1 small">{{ alert.message }}</p>
                    </div>
                    {% endfor %}
                </div>
                {% else %}
                <div class="text-center py-3">
                    <i class="fas fa-check-circle fa-2x text-success mb-2"></i>
                    <p class="text-muted mb-0">All systems operational</p>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

<!-- Detailed Reports -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card shadow">
            <div class="card-header py-3">
                <h6 class="m-0 font-weight-bold text-primary">Detailed Analytics</h6>
            </div>
            <div class="card-body">
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <div class="card border-0 bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-user-times fa-2x text-danger mb-3"></i>
                                <h5>Chronic Absenteeism</h5>
                                <div class="h3 text-danger">{{ analytics.chronic_absentees }}</div>
                                <p class="text-muted">Students with >20% absence</p>
                                <button class="btn btn-sm btn-outline-danger" onclick="viewChronicAbsentees()">
                                    View Details
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card border-0 bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-trophy fa-2x text-success mb-3"></i>
                                <h5>Perfect Attendance</h5>
                                <div class="h3 text-success">{{ analytics.perfect_attendance }}</div>
                                <p class="text-muted">100% attendance this month</p>
                                <button class="btn btn-sm btn-outline-success" onclick="viewPerfectAttendance()">
                                    View Details
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="col-md-4 mb-3">
                        <div class="card border-0 bg-light">
                            <div class="card-body text-center">
                                <i class="fas fa-clock fa-2x text-warning mb-3"></i>
                                <h5>Frequent Latecomers</h5>
                                <div class="h3 text-warning">{{ analytics.frequent_latecomers }}</div>
                                <p class="text-muted">>5 late arrivals this month</p>
                                <button class="btn btn-sm btn-outline-warning" onclick="viewLatecomers()">
                                    View Details
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
function runAttendanceAudit() {
    document.getElementById('reportModalTitle').textContent = 'Attendance System Audit';
    document.getElementById('reportPreview').innerHTML = `
        <div class="text-center py-5">
            <div class="spinner-border text-primary" role="status">
                <span class="visually-hidden">Running system audit...</span>
            </div>
            <p class="mt-2">Running comprehensive system audit...</p>
        </div>
    `;
    
    // Simulate audit process
    setTimeout(() => {
        document.getElementById('reportPreview').innerHTML = `
            <h6>System Audit Results</h6>
            <p class="text-muted">Audit completed on ${new Date().toLocaleString()}</p>
            
            <div class="alert alert-success">
                <i class="fas fa-check-circle me-2"></i>
                <strong>Data Integrity:</strong> All attendance records are valid and consistent.
            </div>
            
            <div class="alert alert-warning">
                <i class="fas fa-exclamation-triangle me-2"></i>
                <strong>Configuration:</strong> 2 sessions need timing adjustments to avoid conflicts.
            </div>
            
            <div class="alert alert-info">
                <i class="fas fa-info-circle me-2"></i>
                <strong>Performance:</strong> System response time is within acceptable limits.
            </div>
            
            <div class="mt-3">
                <button class="btn btn-primary" onclick="generateAuditReport()">
                    <i class="fas fa-download me-1"></i> Download Full Audit Report
                </button>
            </div>
        `;
    }, 2000);
    
    const modal = new bootstrap.Modal(document.getElementById('reportModal'));
    modal.show();
}

function viewChronicAbsentees() {
    alert('Would show detailed chronic absenteeism report');
}

function viewPerfectAttendance() {
    alert('Would show perfect attendance students list');
}

function viewLatecomers() {
    alert('Would show frequent latecomers report');
}

function generateAuditReport() {
    alert('Full audit report download would start here');
}
</script>
