<!-- templates/transport/routes/route_confirm_delete.html -->
{% extends 'base.html' %}
{% load static %}
{% load i18n %}

{% block title %}{% trans "Delete Route" %}{% endblock %}

{% block page_title %}{% trans "Delete Route" %}{% endblock %}

{% block breadcrumb_items %}
<li class="breadcrumb-item"><a href="{% url 'users:dashboard' %}">{% trans "Home" %}</a></li>
<li class="breadcrumb-item"><a href="{% url 'transport:route_list' %}">{% trans "Routes" %}</a></li>
<li class="breadcrumb-item active" aria-current="page">{% trans "Delete Route" %}</li>
{% endblock %}

{% block extra_css %}
<style>
    .delete-confirmation-card {
        border-radius: 12px;
        border: none;
        box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        border-left: 4px solid #dc3545;
        max-width: 600px;
        margin: 0 auto;
    }
    
    .warning-icon {
        width: 80px;
        height: 80px;
        border-radius: 50%;
        background-color: #f8d7da;
        color: #dc3545;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 2rem;
        margin: 0 auto 1.5rem;
    }
    
    .route-details {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1.5rem;
        margin: 1.5rem 0;
    }
    
    .detail-item {
        display: flex;
        justify-content: space-between;
        padding: 0.5rem 0;
        border-bottom: 1px solid #e9ecef;
    }
    
    .detail-item:last-child {
        border-bottom: none;
    }
    
    .detail-label {
        font-weight: 600;
        color: #6c757d;
    }
    
    .detail-value {
        font-weight: 500;
    }
    
    .impact-warning {
        background-color: #fff3cd;
        border-left: 4px solid #ffc107;
        padding: 1rem;
        border-radius: 0 8px 8px 0;
        margin: 1.5rem 0;
    }
    
    .impact-item {
        display: flex;
        align-items: flex-start;
        margin-bottom: 0.5rem;
    }
    
    .impact-item:last-child {
        margin-bottom: 0;
    }
    
    .impact-icon {
        color: #fd7e14;
        margin-right: 0.75rem;
        margin-top: 0.125rem;
    }
    
    .btn-delete {
        background-color: #dc3545;
        border-color: #dc3545;
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 8px;
    }
    
    .btn-delete:hover {
        background-color: #bb2d3b;
        border-color: #b02a37;
    }
    
    .btn-cancel {
        padding: 0.75rem 2rem;
        font-weight: 600;
        border-radius: 8px;
    }
    
    .related-items {
        background-color: #f8f9fa;
        border-radius: 8px;
        padding: 1rem;
        margin-top: 1.5rem;
    }
    
    .related-item {
        display: flex;
        align-items: center;
        padding: 0.5rem;
        border-radius: 6px;
        margin-bottom: 0.5rem;
        background-color: white;
    }
    
    .related-item:last-child {
        margin-bottom: 0;
    }
    
    .related-icon {
        width: 40px;
        height: 40px;
        border-radius: 8px;
        display: flex;
        align-items: center;
        justify-content: center;
        margin-right: 1rem;
        font-size: 1rem;
    }
    
    .schedule-icon {
        background-color: #e7f1ff;
        color: #0d6efd;
    }
    
    .allocation-icon {
        background-color: #e8f5e8;
        color: #198754;
    }
    
    .stop-icon {
        background-color: #fef7e6;
        color: #fd7e14;
    }
</style>
{% endblock %}

{% block content %}
<div class="delete-route-confirmation">
    <div class="row justify-content-center">
        <div class="col-lg-8">
            <div class="card delete-confirmation-card">
                <div class="card-body text-center py-4">
                    <!-- Warning Icon -->
                    <div class="warning-icon">
                        <i class="fas fa-exclamation-triangle"></i>
                    </div>
                    
                    <!-- Confirmation Title -->
                    <h3 class="card-title text-danger mb-3">{% trans "Delete Route Confirmation" %}</h3>
                    <p class="card-text text-muted mb-4">
                        {% trans "You are about to permanently delete this route. This action cannot be undone." %}
                    </p>
                    
                    <!-- Route Details -->
                    <div class="route-details text-start">
                        <h5 class="mb-3">{% trans "Route Information" %}</h5>
                        <div class="detail-item">
                            <span class="detail-label">{% trans "Route Code:" %}</span>
                            <span class="detail-value">{{ route.code }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">{% trans "Route Name:" %}</span>
                            <span class="detail-value">{{ route.name }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">{% trans "Start Point:" %}</span>
                            <span class="detail-value">{{ route.start_point }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">{% trans "End Point:" %}</span>
                            <span class="detail-value">{{ route.end_point }}</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">{% trans "Distance:" %}</span>
                            <span class="detail-value">{{ route.total_distance }} km</span>
                        </div>
                        <div class="detail-item">
                            <span class="detail-label">{% trans "Status:" %}</span>
                            <span class="detail-value">
                                {% if route.is_active %}
                                <span class="badge bg-success">{% trans "Active" %}</span>
                                {% else %}
                                <span class="badge bg-secondary">{% trans "Inactive" %}</span>
                                {% endif %}
                            </span>
                        </div>
                    </div>
                    
                    <!-- Impact Warning -->
                    <div class="impact-warning text-start">
                        <h6 class="text-warning mb-3">
                            <i class="fas fa-exclamation-circle me-2"></i>
                            {% trans "This action will also affect:" %}
                        </h6>
                        
                        <div class="impact-item">
                            <i class="fas fa-calendar-times impact-icon"></i>
                            <div>
                                <strong>{{ route.route_schedules.count }} {% trans "Route Schedules" %}</strong>
                                <p class="small mb-0 text-muted">{% trans "All scheduled operations for this route will be cancelled" %}</p>
                            </div>
                        </div>
                        
                        <div class="impact-item">
                            <i class="fas fa-users impact-icon"></i>
                            <div>
                                <strong>{{ route.student_allocations.count }} {% trans "Student Allocations" %}</strong>
                                <p class="small mb-0 text-muted">{% trans "All student transport allocations will be removed" %}</p>
                            </div>
                        </div>
                        
                        <div class="impact-item">
                            <i class="fas fa-map-marker-alt impact-icon"></i>
                            <div>
                                <strong>{{ route.stops.count }} {% trans "Route Stops" %}</strong>
                                <p class="small mb-0 text-muted">{% trans "All stops associated with this route will be deleted" %}</p>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Related Items Preview -->
                    {% if route.route_schedules.exists or route.student_allocations.exists %}
                    <div class="related-items text-start">
                        <h6 class="mb-3">{% trans "Related items that will be affected:" %}</h6>
                        
                        <!-- Route Schedules -->
                        {% for schedule in route.route_schedules.all|slice:":3" %}
                        <div class="related-item">
                            <div class="related-icon schedule-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                            <div class="flex-grow-1">
                                <strong>{% trans "Schedule" %}</strong>
                                <p class="small mb-0 text-muted">
                                    {{ schedule.vehicle.vehicle_number }} • 
                                    {{ schedule.driver.user.get_full_name }} •
                                    {{ schedule.academic_session.name }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <!-- Student Allocations -->
                        {% for allocation in route.student_allocations.all|slice:":3" %}
                        <div class="related-item">
                            <div class="related-icon allocation-icon">
                                <i class="fas fa-user-graduate"></i>
                            </div>
                            <div class="flex-grow-1">
                                <strong>{{ allocation.student.get_full_name }}</strong>
                                <p class="small mb-0 text-muted">
                                    {{ allocation.allocation_type }} • 
                                    {{ allocation.pickup_stop.name }} →
                                    {{ allocation.drop_stop.name }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                        
                        <!-- Route Stops -->
                        {% for stop in route.stops.all|slice:":3" %}
                        <div class="related-item">
                            <div class="related-icon stop-icon">
                                <i class="fas fa-map-pin"></i>
                            </div>
                            <div class="flex-grow-1">
                                <strong>{{ stop.name }}</strong>
                                <p class="small mb-0 text-muted">
                                    {% trans "Stop" %} {{ stop.sequence }} • 
                                    {{ stop.estimated_arrival_time|time:"H:i" }}
                                </p>
                            </div>
                        </div>
                        {% endfor %}
                        
                        {% if route.route_schedules.count > 3 or route.student_allocations.count > 3 or route.stops.count > 3 %}
                        <div class="text-center mt-2">
                            <small class="text-muted">
                                {% trans "and" %} 
                                {{ route.route_schedules.count|add:route.student_allocations.count|add:route.stops.count|add:"-9" }} 
                                {% trans "more items..." %}
                            </small>
                        </div>
                        {% endif %}
                    </div>
                    {% endif %}
                    
                    <!-- Final Warning -->
                    <div class="alert alert-danger mt-4" role="alert">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-radiation-alt me-2 fs-5"></i>
                            <div>
                                <strong>{% trans "Critical Action:" %}</strong> 
                                {% trans "This will permanently remove all route data and cannot be recovered." %}
                            </div>
                        </div>
                    </div>
                    
                    <!-- Confirmation Form -->
                    <form method="post">
                        {% csrf_token %}
                        
                        <!-- Safety Check -->
                        <div class="form-check mb-4">
                            <input class="form-check-input" type="checkbox" id="confirmDelete" required>
                            <label class="form-check-label" for="confirmDelete">
                                <strong>{% trans "I understand that this action is permanent and cannot be undone" %}</strong>
                            </label>
                        </div>
                        
                        <!-- Action Buttons -->
                        <div class="d-flex justify-content-center gap-3">
                            <a href="{% url 'transport:route_list' %}" class="btn btn-outline-secondary btn-cancel">
                                <i class="fas fa-arrow-left me-2"></i>
                                {% trans "Cancel" %}
                            </a>
                            <button type="submit" class="btn btn-delete" id="deleteButton" disabled>
                                <i class="fas fa-trash me-2"></i>
                                {% trans "Delete Route" %}
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Alternative Actions -->
            <div class="card mt-4">
                <div class="card-body">
                    <h6 class="card-title">{% trans "Alternative Actions" %}</h6>
                    <p class="card-text text-muted small mb-3">
                        {% trans "Consider these alternatives before deleting:" %}
                    </p>
                    <div class="row g-2">
                        <div class="col-md-4">
                            <a href="{% url 'transport:route_update' route.pk %}" class="btn btn-outline-primary w-100">
                                <i class="fas fa-edit me-1"></i>
                                {% trans "Edit Route" %}
                            </a>
                        </div>
                        <div class="col-md-4">
                            {% if route.is_active %}
                            <a href="#" class="btn btn-outline-warning w-100" id="deactivateRoute">
                                <i class="fas fa-pause me-1"></i>
                                {% trans "Deactivate" %}
                            </a>
                            {% else %}
                            <a href="#" class="btn btn-outline-success w-100" id="activateRoute">
                                <i class="fas fa-play me-1"></i>
                                {% trans "Activate" %}
                            </a>
                            {% endif %}
                        </div>
                        <div class="col-md-4">
                            <a href="{% url 'transport:route_detail' route.pk %}" class="btn btn-outline-info w-100">
                                <i class="fas fa-eye me-1"></i>
                                {% trans "View Details" %}
                            </a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Enable delete button only when confirmation checkbox is checked
        const confirmCheckbox = document.getElementById('confirmDelete');
        const deleteButton = document.getElementById('deleteButton');
        
        confirmCheckbox.addEventListener('change', function() {
            deleteButton.disabled = !this.checked;
        });
        
        // Add confirmation dialog for delete button
        deleteButton.addEventListener('click', function(e) {
            if (!confirm('{% trans "Are you absolutely sure you want to delete this route? This action cannot be undone." %}')) {
                e.preventDefault();
            }
        });
        
        // Deactivate/Activate route functionality
        const deactivateBtn = document.getElementById('deactivateRoute');
        const activateBtn = document.getElementById('activateRoute');
        
        if (deactivateBtn) {
            deactivateBtn.addEventListener('click', function(e) {
                e.preventDefault();
                if (confirm('{% trans "Deactivate this route instead of deleting? This will preserve all data but make the route unavailable for new allocations." %}')) {
                    // In a real implementation, this would make an API call to deactivate the route
                    window.location.href = '{% url "transport:route_update" route.pk %}';
                }
            });
        }
        
        if (activateBtn) {
            activateBtn.addEventListener('click', function(e) {
                e.preventDefault();
                // In a real implementation, this would make an API call to activate the route
                window.location.href = '{% url "transport:route_update" route.pk %}';
            });
        }
        
        // Add safety delay for delete button even when enabled
        let deleteEnabled = false;
        
        confirmCheckbox.addEventListener('change', function() {
            if (this.checked && !deleteEnabled) {
                deleteEnabled = true;
                // Small delay to prevent accidental clicks
                setTimeout(() => {
                    deleteButton.disabled = false;
                }, 500);
            } else if (!this.checked) {
                deleteEnabled = false;
                deleteButton.disabled = true;
            }
        });
        
        // Add animation to the warning icon
        const warningIcon = document.querySelector('.warning-icon');
        warningIcon.style.transform = 'scale(0)';
        warningIcon.style.transition = 'transform 0.5s ease';
        
        setTimeout(() => {
            warningIcon.style.transform = 'scale(1)';
        }, 100);
        
        // Pulse animation for critical warning
        const criticalWarning = document.querySelector('.alert-danger');
        setInterval(() => {
            criticalWarning.classList.toggle('border-danger');
        }, 1000);
    });
</script>
{% endblock %}